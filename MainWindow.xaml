<syncfusion:ChromelessWindow x:Class="VANTAGE.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
        xmlns:views="clr-namespace:VANTAGE.Views"
        mc:Ignorable="d"
        Title="VANTAGE: MILESTONE"
        ShowTitle="False"                   
        TitleBarHeight="0"
        Height="1080"
        Width="1920"
        WindowState="Maximized"
        Background="{StaticResource BackgroundColor}"
        Icon="pack://application:,,,/images/AppIcon.ico">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>
        <!-- TOOLBAR -->
        <Border Grid.Row="0"
                Background="{StaticResource DarkestBackgroundColor}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0"
                MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">

            <Grid Height="40">
                <Grid.ColumnDefinitions>
                    <!-- Navigation -->
                    <ColumnDefinition Width="*"/>
                    <!-- APP TOOLS -->
                    <ColumnDefinition Width="Auto"/>
                    <!-- Window controls -->
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

               

                <!-- COLUMN 1: /APP MENU ITEMS -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Image Width="35" 
                           Margin="10,0,20,0"
                           Source="pack://application:,,,/images/MilestoneLogoPngTransparentBG.png" 
                           Stretch="Uniform" />

                    <syncfusion:DropDownButtonAdv x:Name="btnFile"
                                Label="File"
                                Padding="0"
                                Margin="5,0"
                                Background="Transparent"
                                Foreground="{StaticResource ForegroundColor}"
                                BorderThickness="0"
                                IconTemplate="{x:Null}"
                                SmallIcon="{x:Null}"
                                LargeIcon="{x:Null}"
                                FontSize="12"
                                SizeMode="Normal"
                                ToolTip="File actions">
                        <syncfusion:DropDownMenuGroup
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}">
                            <!-- Activities -->
                            <syncfusion:DropDownMenuItem Header="Import Activities (Replace)" Click="MenuExcelImportReplace_Click"/>
                            <syncfusion:DropDownMenuItem Header="Import Activities (Combine)" Click="MenuExcelImportCombine_Click"/>
                            <syncfusion:DropDownMenuItem Header="Export Activities" Click="ExcelExportActivities_Click"/>
                            <syncfusion:DropDownMenuItem Header="Export Activities Template" Click="ExcelExportTemplate_Click"/>
                            <syncfusion:DropDownMenuItem Header="Create Activities" Click="BtnCreate_Click"/>
                            <syncfusion:DropDownMenuItem Header="Clear Local Activities" Click="MenuClearLocalActivities_Click"/>
                            <Separator Background="{StaticResource BorderColor}" Margin="5,2"/>
                            <!-- P6 Files -->
                            <syncfusion:DropDownMenuItem Header="Import From P6 File" Click="ImportP6File_Click"/>
                            <syncfusion:DropDownMenuItem Header="Export To P6 File" Click="ExportP6File_Click"/>
                            <syncfusion:DropDownMenuItem Header="Clear Local Schedule" Click="MenuClearLocalSchedule_Click"/>
                            <Separator Background="{StaticResource BorderColor}" Margin="5,2"/>
                            <!-- Other -->
                            <syncfusion:DropDownMenuItem Header="Export Logs" Click="MenuExportLogs_Click"/>
                            <syncfusion:DropDownMenuItem Header="Manage My Snapshots" Click="MenuManageSnapshots_Click"/>
                        </syncfusion:DropDownMenuGroup>
                    </syncfusion:DropDownButtonAdv>

                    <syncfusion:DropDownButtonAdv x:Name="btnTools"
                              Label="Tools"
                              Padding="0"
                              Margin="5,0"
                              Background="Transparent"
                              Foreground="{StaticResource ForegroundColor}"
                              BorderThickness="0"
                              IconTemplate="{x:Null}"
                              SmallIcon="{x:Null}"
                              LargeIcon="{x:Null}"
                              FontSize="12"
                              SizeMode="Normal"
                              ToolTip="Utilities and maintenance options">
                        <syncfusion:DropDownMenuGroup
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}">
                            <syncfusion:DropDownMenuItem Header="Help / AI Sidebar     (F1)" Click="MenuHelpSidebar_Click" ToolTip="Open context-aware help and AI assistant"/>
                            <Separator Background="{StaticResource BorderColor}" Margin="5,2"/>
                            <syncfusion:DropDownMenuItem Header="Prorate MHs" Click="MenuProrateMHs_Click"/>
                        </syncfusion:DropDownMenuGroup>
                    </syncfusion:DropDownButtonAdv>

                    <syncfusion:DropDownButtonAdv x:Name="btnAdmin"
                              Label="Admin"
                              Padding="0"
                              Margin="5,0"
                          Background="Transparent"
                          Foreground="{StaticResource ForegroundColor}"
                              BorderThickness="0"
                              IconTemplate="{x:Null}"
                              SmallIcon="{x:Null}"
                              LargeIcon="{x:Null}"
                              FontSize="12"
                              SizeMode="Normal">
                        <syncfusion:DropDownMenuGroup
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}">
                            <syncfusion:DropDownMenuItem Header="Toggle User Admin" Click="ToggleUserAdmin_Click"/>
                            <Separator Background="{StaticResource BorderColor}" Margin="5,2"/>
                            <syncfusion:DropDownMenuItem Header="Edit Users" Click="MenuEditUsers_Click"/>
                            <syncfusion:DropDownMenuItem Header="Edit Projects" Click="MenuEditProjects_Click"/>
                            <syncfusion:DropDownMenuItem Header="Edit Snapshots" Click="MenuEditSnapshots_Click"/>
                            <Separator Background="{StaticResource BorderColor}" Margin="5,2"/>
                            <syncfusion:DropDownMenuItem Header="Deleted Records UI" Click="DeletedRecordsUi_Click"/>
                        </syncfusion:DropDownMenuGroup>
                    </syncfusion:DropDownButtonAdv>

                    <syncfusion:ButtonAdv x:Name="btnTest"
                          Label="TEST ▼"
                          Padding="0"
                          Margin="5,0"
                          Background="Transparent"
                          Foreground="{StaticResource ForegroundColor}"
                          BorderThickness="0"
                          IconTemplate="{x:Null}"
                          SmallIcon="{x:Null}"
                          LargeIcon="{x:Null}"
                          FontSize="12"
                          Click="BtnTest_Click">
                        <syncfusion:ButtonAdv.ContextMenu>
                            <ContextMenu x:Name="menuTest"
                                         Background="{StaticResource ControlBackground}"
                                         Foreground="{StaticResource ForegroundColor}"
                                         BorderBrush="{StaticResource BorderColor}">
                                <MenuItem Header="Toggle Admin Status" Click="MenuToggleAdmin_Click"/>
                                <MenuItem Header="Reset LocalDirty (All Records)" Click="MenuResetLocalDirty_Click"/>
                                <MenuItem Header="Toggle UpdatedBy" Click="ToggleUpdatedBy_Click"/>
                                <MenuItem Header="Schedule Diagnostics" Click="MenuScheduleDiagnostics_Click"/>
                                <MenuItem Header="Clear Azure Activities" Click="MenuClearAzureActivities_Click"/>
                                <MenuItem Header="Test Procore Drawings" Click="MenuTestProcoreDrawings_Click"/>
                            </ContextMenu>
                        </syncfusion:ButtonAdv.ContextMenu>
                    </syncfusion:ButtonAdv>

                </StackPanel>
                <!-- COLUMN 2: NAVIGATION BUTTONS -->

                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">

                    <Grid>
                        <syncfusion:ButtonAdv x:Name="btnProgress"
                                               Label="PROGRESS"
                                               Padding="15,0"
                                               Background="Transparent"
                                               Foreground="{StaticResource ForegroundColor}"
                                               BorderThickness="0"
                                               IconTemplate="{x:Null}"
                                               SmallIcon="{x:Null}"
                                               LargeIcon="{x:Null}"
                                               FontSize="12"
                                               FontWeight="Bold"
                                               Click="BtnProgress_Click"
                                               ToolTip="Track activity completion and earned values"/>
                        <Border x:Name="borderProgress"
                                 Width="100"
                                 Height="3"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Bottom"
                                 Background="Transparent"/>
                    </Grid>

                    <Grid>
                        <syncfusion:ButtonAdv x:Name="btnSchedule"
                                               Label="SCHEDULE"
                                               Padding="15,0"
                                               Background="Transparent"
                                               Foreground="{StaticResource ForegroundColor}"
                                               BorderThickness="0"
                                               IconTemplate="{x:Null}"
                                               SmallIcon="{x:Null}"
                                               LargeIcon="{x:Null}"
                                               FontSize="12"
                                               FontWeight="Bold"
                                               Click="BtnSchedule_Click"
                                               ToolTip="View and edit P6 schedule data"/>
                                                <Border x:Name="borderSchedule"
                                                         Width="100"
                                                         Height="3"
                                                         HorizontalAlignment="Stretch"
                                                         VerticalAlignment="Bottom"
                                                         Background="Transparent"/>
                    </Grid>
                    <Grid>
                        <syncfusion:ButtonAdv x:Name="btnPbook"
                                               Label="PROG BOOKS"
                                               Padding="15,0"
                                               Margin="5,0"
                                               Background="Transparent"
                                               Foreground="{StaticResource ForegroundColor}"
                                               BorderThickness="0"
                                               IconTemplate="{x:Null}"
                                               SmallIcon="{x:Null}"
                                               LargeIcon="{x:Null}"
                                               FontSize="12"
                                               FontWeight="Bold"
                                               Click="BtnPbook_Click"
                                               ToolTip="Generate progress books"/>
                        <Border x:Name="ProgBookBorder"
                                 Width="100"
                                 Height="3"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Bottom"
                                 Background="Transparent"/>
                    </Grid>
                    <Grid>
                        <syncfusion:ButtonAdv x:Name="btnWorkPackage"
                                             Label="WORK PKGS"
                                             Padding="15,0"
                                             Margin="5,0"
                                             Background="Transparent"
                                             Foreground="{StaticResource ForegroundColor}"
                                             BorderThickness="0"
                                             IconTemplate="{x:Null}"
                                             SmallIcon="{x:Null}"
                                             LargeIcon="{x:Null}"
                                             FontSize="12"
                                             FontWeight="Bold"
                                             Click="BtnWorkPackage_Click"
                                             ToolTip="Manage work packages"/>
                        <Border x:Name="WorkPackageBorder"
                                 Width="100"
                                 Height="3"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Bottom"
                                 Background="Transparent"/>
                    </Grid>
                </StackPanel>
                
                <!-- COLUMN 3: WINDOW CONTROLS (RIGHT) -->
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                    <!-- Settings Button + Popup -->
                    <Button x:Name="btnSettings"
                            Content="⋮"
                            Padding="8,0"
                            Margin="5,0,10,0"
                            Background="Transparent"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderThickness="0"
                            FontSize="16"
                            FontWeight="Bold"
                            ToolTip="Settings"
                            Click="BtnSettings_Click"/>

                    <Popup x:Name="popupSettings"
                           PlacementTarget="{Binding ElementName=btnSettings}"
                           Placement="Bottom"
                           StaysOpen="False"
                           AllowsTransparency="True">
                        <Border Background="{StaticResource ControlBackground}"
                                BorderBrush="{StaticResource BorderColor}"
                                BorderThickness="1"
                                CornerRadius="2"
                                Padding="0">
                            <StackPanel>
                                <Button Content="Help / AI Sidebar   (F1)"
                                        Background="Transparent"
                                        Foreground="{StaticResource ForegroundColor}"
                                        BorderThickness="0"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Left"
                                        Click="MenuHelpSidebar_Click"
                                        Cursor="Hand"/>
                                <Button Content="Feedback Board"
                                        Background="Transparent"
                                        Foreground="{StaticResource ForegroundColor}"
                                        BorderThickness="0"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Left"
                                        Click="MenuFeedbackBoard_Click"
                                        Cursor="Hand"
                                        ToolTip="Submit ideas or report bugs"/>
                                <Separator Background="{StaticResource BorderColor}" Margin="5,2"/>
                                <Button Content="Import Settings"
                                        Background="Transparent"
                                        Foreground="{StaticResource ForegroundColor}"
                                        BorderThickness="0"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Left"
                                        Click="MenuImportSettings_Click"
                                        Cursor="Hand"
                                        ToolTip="Import application settings from file"/>
                                <Button Content="Export Settings"
                                        Background="Transparent"
                                        Foreground="{StaticResource ForegroundColor}"
                                        BorderThickness="0"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Left"
                                        Click="MenuExportSettings_Click"
                                        Cursor="Hand"
                                        ToolTip="Export application settings to file"/>
                                <Button Content="Grid Layouts..."
                                        Background="Transparent"
                                        Foreground="{StaticResource ForegroundColor}"
                                        BorderThickness="0"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Left"
                                        Click="MenuGridLayouts_Click"
                                        Cursor="Hand"
                                        ToolTip="Save and apply custom column layouts"/>
                                <Separator Background="{StaticResource BorderColor}" Margin="5,2"/>
                                <Button Content="About MILESTONE"
                                        Background="Transparent"
                                        Foreground="{StaticResource ForegroundColor}"
                                        BorderThickness="0"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Left"
                                        Click="MenuAbout_Click"
                                        Cursor="Hand"
                                        ToolTip="Application version and information"/>
                            </StackPanel>
                        </Border>
                    </Popup>

                    <Button x:Name="btnMinimize"
                            Content="─"
                            Width="46"
                            Background="Transparent"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderThickness="0"
                            FontSize="16"
                            Click="BtnMinimize_Click"
                            ToolTip="Minimize"/>

                    <Button x:Name="btnMaximize"
                            Content="☐"
                            Width="46"
                            Background="Transparent"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderThickness="0"
                            FontSize="16"
                            Click="BtnMaximize_Click"
                            ToolTip="Maximize"/>

                    <Button x:Name="btnClose"
                            Width="46"
                            Click="BtnClose_Click"
                            ToolTip="Close">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="Transparent">
                                    <TextBlock Text="✕" 
                                               FontSize="16"
                                               Foreground="{StaticResource ForegroundColor}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#E81123"/>
                                        <Setter TargetName="border" Property="TextBlock.Foreground" Value="White"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>

                </StackPanel>
                    

            </Grid>
        </Border>

        <!-- CONTENT AREA WITH SIDEBAR -->
        <Border Grid.Row="1" Background="{StaticResource BackgroundColor}">
            <Grid x:Name="ContentGrid">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition x:Name="SplitterColumn" Width="0"/>
                    <ColumnDefinition x:Name="SidebarColumn" Width="0"/>
                </Grid.ColumnDefinitions>

                <!-- Main Content -->
                <ContentControl x:Name="ContentArea" Grid.Column="0"/>

                <!-- GridSplitter (only visible when sidebar open) -->
                <GridSplitter x:Name="SidebarSplitter"
                              Grid.Column="1"
                              Width="5"
                              HorizontalAlignment="Stretch"
                              Background="{StaticResource BorderColor}"
                              Visibility="Collapsed"
                              Cursor="SizeWE"
                              DragCompleted="SidebarSplitter_DragCompleted"/>

                <!-- Side Panel -->
                <views:SidePanelView x:Name="SidePanel"
                             Grid.Column="2"
                             Visibility="Collapsed"/>
            </Grid>
        </Border>
        <!-- STATUS BAR -->
        <Border Grid.Row="2"
        Background="{StaticResource StatusBarBackground}"
        BorderBrush="{StaticResource BorderColor}"
        BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                   x:Name="txtAppVersion"
                   Text="Vantage: MILESTONE v1.0.0"
                   Foreground="{StaticResource AccentColor}"
                   FontSize="11"
                   FontWeight="SemiBold"
                   VerticalAlignment="Center"
                   Margin="10,0,20,0"/>

                <TextBlock Grid.Column="1"
                   x:Name="txtCurrentUser"
                   Text="User: Steve.Amalfitano"
                   Foreground="{StaticResource StatusBarForeground}"
                   FontSize="11"
                   VerticalAlignment="Center"
                   Margin="0,0,20,0"/>

                <TextBlock Grid.Column="3"
                   x:Name="txtLastSyncsd"
                   Text="Last Sync: Never"
                   Foreground="{StaticResource StatusBarForeground}"
                   FontSize="11"
                   VerticalAlignment="Center"
                   Margin="0,0,20,0"/>
            </Grid>
        </Border>
        <!-- Modern Loading Overlay for Excel Imports -->
        <Grid x:Name="LoadingOverlay"
              Grid.RowSpan="3"
              Background="{StaticResource OverlayBackground}"
              Visibility="Collapsed"
              Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <!-- Syncfusion Busy Indicator -->
                <syncfusion:SfBusyIndicator x:Name="BusyIndicator"
                                    IsBusy="True"
                                    AnimationType="DualRing"
                                    ViewboxWidth="80"
                                    ViewboxHeight="80"
                                    Foreground="{StaticResource AccentColor}"/>
                <!-- Loading Text -->
                <TextBlock x:Name="txtLoadingMessage"
                   Text="Importing Excel File..."
                   FontSize="18"
                   FontWeight="SemiBold"
                   Foreground="{StaticResource OverlayText}"
                   HorizontalAlignment="Center"
                   Margin="0,30,0,10"/>
                <!-- Progress Text -->
                <TextBlock x:Name="txtLoadingProgress"
                   Text="0 of 0 records"
                   FontSize="14"
                   Foreground="{StaticResource OverlayTextSecondary}"
                   HorizontalAlignment="Center"
                   Margin="0,0,0,15"/>
                <!-- Progress Bar -->
                <syncfusion:SfLinearProgressBar x:Name="LoadingProgressBar"
                     Width="300"
                     Height="8"
                     IsIndeterminate="True"
                     ProgressColor="{StaticResource AccentColor}"
                     TrackColor="#333333"/>
            </StackPanel>
        </Grid>

    </Grid>
</syncfusion:ChromelessWindow>