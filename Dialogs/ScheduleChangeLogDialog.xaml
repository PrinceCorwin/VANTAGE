<Window x:Class="VANTAGE.Dialogs.ScheduleChangeLogDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Schedule Change Log"
        Height="550"
        Width="950"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundColor}"
        ResizeMode="CanResize"
        MinHeight="400"
        MinWidth="700"
        WindowStyle="SingleBorderWindow">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="15"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="15"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="15"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="Schedule Change Log"
                       FontWeight="SemiBold"
                       FontSize="16"
                       Foreground="{DynamicResource ForegroundColor}"/>
            <TextBlock Text="Review changes made in the Schedule detail grid"
                       Foreground="{DynamicResource ForegroundColor}"
                       Opacity="0.7"
                       FontSize="12"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Change List -->
        <Border Grid.Row="2"
                Background="{DynamicResource ControlBackground}"
                BorderBrush="{DynamicResource BorderColor}"
                BorderThickness="1"
                CornerRadius="4">
            <Grid>
                <ListView x:Name="lvChanges"
                          Background="Transparent"
                          BorderThickness="0"
                          Foreground="{DynamicResource ForegroundColor}"
                          SelectionMode="Extended">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Width="50">
                                <GridViewColumn.Header>
                                    <CheckBox x:Name="chkSelectAll"
                                              Checked="ChkSelectAll_Checked"
                                              Unchecked="ChkSelectAll_Unchecked"
                                              ToolTip="Select/deselect all"/>
                                </GridViewColumn.Header>
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                  Checked="ItemCheckBox_Changed"
                                                  Unchecked="ItemCheckBox_Changed"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Week End Date" Width="100" DisplayMemberBinding="{Binding WeekEndDate}"/>
                            <GridViewColumn Header="UniqueID" Width="120" DisplayMemberBinding="{Binding UniqueID}"/>
                            <GridViewColumn Header="Description" Width="200" DisplayMemberBinding="{Binding Description}"/>
                            <GridViewColumn Header="Field" Width="100" DisplayMemberBinding="{Binding Field}"/>
                            <GridViewColumn Header="Old Value" Width="100" DisplayMemberBinding="{Binding OldValue}"/>
                            <GridViewColumn Header="New Value" Width="100" DisplayMemberBinding="{Binding NewValue}"/>
                        </GridView>
                    </ListView.View>
                </ListView>

                <!-- Empty State -->
                <TextBlock x:Name="txtNoChanges"
                           Text="No changes have been logged."
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource ForegroundColor}"
                           Opacity="0.6"
                           Visibility="Collapsed"/>

                <!-- Loading State -->
                <StackPanel x:Name="pnlLoading"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Visibility="Collapsed">
                    <TextBlock Text="Loading changes..."
                               Foreground="{DynamicResource ForegroundColor}"
                               Opacity="0.6"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Selection Summary -->
        <TextBlock x:Name="txtSelectionSummary"
                   Grid.Row="3"
                   Text="0 changes selected"
                   Foreground="{DynamicResource ForegroundColor}"
                   Opacity="0.7"
                   FontSize="12"
                   Margin="0,10,0,0"/>

        <!-- Warning Text -->
        <Border Grid.Row="5"
                Background="{DynamicResource ControlBackground}"
                BorderBrush="{DynamicResource BorderColor}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12">
            <TextBlock TextWrapping="Wrap"
                       Foreground="{DynamicResource ForegroundColor}"
                       FontSize="12">
                <Run FontWeight="SemiBold">Note:</Run>
                <Run>These are changes you made in the Schedule detail grid. Selected changes will be applied to the live Activities, overwriting their current values when the Apply button is clicked. This action cannot be undone. Proceed with caution.</Run>
            </TextBlock>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="7"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right">
            <Button x:Name="btnCancel"
                    Content="Cancel"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    Background="{DynamicResource ControlBackground}"
                    Foreground="{DynamicResource ForegroundColor}"
                    BorderBrush="{DynamicResource ControlBorder}"
                    BorderThickness="1"
                    Click="BtnCancel_Click"/>
            <Button x:Name="btnApply"
                    Content="Apply Selected"
                    Width="120"
                    Height="35"
                    Background="{DynamicResource AccentColor}"
                    Foreground="{DynamicResource ForegroundColor}"
                    BorderBrush="{DynamicResource AccentColor}"
                    BorderThickness="1"
                    IsEnabled="False"
                    ToolTip="Apply selected changes to live Activities"
                    Click="BtnApply_Click"/>
        </StackPanel>
    </Grid>
</Window>
