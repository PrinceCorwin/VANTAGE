<UserControl x:Class="VANTAGE.Views.ScheduleView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:skinManager="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
             skinManager:SfSkinManager.Theme="{skinManager:SkinManagerExtension ThemeName=FluentDark}"
             Background="{StaticResource BackgroundColor}">

    <UserControl.Resources>
        <!-- Filter Button Style with Visual Feedback -->
        <Style x:Key="FilterToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="{StaticResource ControlBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Width" Value="100"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            Margin="5,0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3A3A3C"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentColor}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#2A2A2C"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!-- Required field styles (red background when field needs attention) -->
        <Style x:Key="MissedStartReasonRequiredStyle" TargetType="syncfusion:GridCell">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=IsMissedStartReasonRequired}" Value="True">
                    <Setter Property="Background" Value="#5b2626"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="MissedFinishReasonRequiredStyle" TargetType="syncfusion:GridCell">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=IsMissedFinishReasonRequired}" Value="True">
                    <Setter Property="Background" Value="#5b2626"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ThreeWeekStartRequiredStyle" TargetType="syncfusion:GridCell">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=IsThreeWeekStartRequired}" Value="True">
                    <Setter Property="Background" Value="#5b2626"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ThreeWeekFinishRequiredStyle" TargetType="syncfusion:GridCell">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=IsThreeWeekFinishRequired}" Value="True">
                    <Setter Property="Background" Value="#5b2626"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TOOLBAR -->
        <Border Grid.Row="0"
                Background="{StaticResource ToolbarBackground}"
                BorderBrush="{StaticResource ControlBorder}"
                BorderThickness="0,0,0,1"
                Height="50">
            <StackPanel Orientation="Horizontal" 
                       Margin="15,0"
                       VerticalAlignment="Center">

                <TextBlock Text="Week Ending:" 
                          VerticalAlignment="Center"
                          Foreground="{StaticResource ForegroundColor}"
                          Margin="0,0,10,0"/>
                <ComboBox x:Name="cmbWeekEndDate"
                         Width="150"
                         Height="32"
                         ItemsSource="{Binding AvailableWeekEndDates}"
                         SelectedItem="{Binding SelectedWeekEndDate, Mode=TwoWay}"
                         Background="{StaticResource ControlBackground}"
                         Foreground="{StaticResource ControlForeground}"
                         BorderBrush="{StaticResource ControlBorder}"
                         Margin="0,0,20,0">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding StringFormat='yyyy-MM-dd'}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Text="Filters:" 
                          VerticalAlignment="Center"
                          Foreground="{StaticResource ForegroundColor}"
                          Margin="0,0,10,0"/>

                <ToggleButton x:Name="btnFilterActualStart"
                             Content="Actual Start"
                             IsChecked="{Binding FilterActualStart, Mode=TwoWay}"
                             Style="{StaticResource FilterToggleButtonStyle}"
                             Margin="0,0,5,0"/>

                <ToggleButton x:Name="btnFilterActualFinish"
                             Content="Actual Finish"
                             IsChecked="{Binding FilterActualFinish, Mode=TwoWay}"
                             Style="{StaticResource FilterToggleButtonStyle}"
                             Margin="0,0,5,0"/>

                <ToggleButton x:Name="btnFilter3WLA"
                             Content="3WLA"
                             IsChecked="{Binding Filter3WLA, Mode=TwoWay}"
                             Style="{StaticResource FilterToggleButtonStyle}"
                             Margin="0,0,20,0"/>
                <Button x:Name="btnSave"
                            Content="SAVE"
                            Width="80"
                            Height="32"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            FontSize="11"
                            Click="btnSave_Click"
                            Margin="0,0,5,0"/>
            </StackPanel>
        </Border>

        <!-- MASTER GRID -->
        <syncfusion:SfDataGrid x:Name="sfScheduleMaster"
                      Grid.Row="1"
                      ItemsSource="{Binding MasterRows}"
                      AutoGenerateColumns="False"
                      AllowEditing="True"
                      EditTrigger="OnTap"
                      ColumnSizer="Star"
                      SelectionMode="Single"
                      SelectionUnit="Cell"
                      GridLinesVisibility="Both"
                      HeaderRowHeight="35"
                      RowHeight="30"
                      AllowSorting="True"
                      AllowFiltering="True"
                      AllowResizingColumns="True"
                      AllowDraggingColumns="True"
                      ShowRowHeader="True"
                      RowHeaderWidth="30">

            <syncfusion:SfDataGrid.Columns>

                <syncfusion:GridTextColumn MappingName="SchedActNO" 
                                          HeaderText="SchedActNO" 
                                          Width="120"
                                          AllowEditing="False"/>

                <syncfusion:GridTextColumn MappingName="Description" 
                                          HeaderText="Description" 
                                          Width="250"
                                          AllowEditing="False"/>

                <syncfusion:GridDateTimeColumn MappingName="P6_PlannedStart" 
                                              HeaderText="P6 Planned Start" 
                                              Width="130"
                                              DisplayBinding="{Binding P6_PlannedStart, StringFormat='yyyy-MM-dd'}"
                                              AllowEditing="False"/>

                <syncfusion:GridDateTimeColumn MappingName="P6_PlannedFinish" 
                                              HeaderText="P6 Planned Finish" 
                                              Width="130"
                                              DisplayBinding="{Binding P6_PlannedFinish, StringFormat='yyyy-MM-dd'}"
                                              AllowEditing="False"/>

                <syncfusion:GridDateTimeColumn MappingName="P6_ActualStart" 
                                              HeaderText="P6 Actual Start" 
                                              Width="130"
                                              DisplayBinding="{Binding P6_ActualStart, StringFormat='yyyy-MM-dd'}"
                                              AllowEditing="False"/>

                <syncfusion:GridDateTimeColumn MappingName="P6_ActualFinish" 
                                              HeaderText="P6 Actual Finish" 
                                              Width="130"
                                              DisplayBinding="{Binding P6_ActualFinish, StringFormat='yyyy-MM-dd'}"
                                              AllowEditing="False"/>

                <syncfusion:GridNumericColumn MappingName="P6_PercentComplete" 
                                             HeaderText="P6 %" 
                                             Width="80"
                                             NumberDecimalDigits="1"
                                             AllowEditing="False"/>

                <syncfusion:GridNumericColumn MappingName="P6_BudgetMHs" 
                                             HeaderText="P6 MHs" 
                                             Width="90"
                                             NumberDecimalDigits="1"
                                             AllowEditing="False"/>

                <syncfusion:GridDateTimeColumn MappingName="MS_ActualStart" 
                                              HeaderText="MS Start" 
                                              Width="110"
                                              DisplayBinding="{Binding MS_ActualStart, StringFormat='yyyy-MM-dd'}"
                                              AllowEditing="False"/>

                <syncfusion:GridDateTimeColumn MappingName="MS_ActualFinish" 
                                              HeaderText="MS Finish" 
                                              Width="110"
                                              DisplayBinding="{Binding MS_ActualFinish, StringFormat='yyyy-MM-dd'}"
                                              AllowEditing="False"/>

                <syncfusion:GridNumericColumn MappingName="MS_PercentComplete" 
                                             HeaderText="MS %" 
                                             Width="80"
                                             NumberDecimalDigits="1"
                                             AllowEditing="False"/>

                <syncfusion:GridNumericColumn MappingName="MS_BudgetMHs" 
                                             HeaderText="MS MHs" 
                                             Width="90"
                                             NumberDecimalDigits="1"
                                             AllowEditing="False"/>

                <syncfusion:GridTextColumn MappingName="MissedStartReason" 
                          HeaderText="Missed Start Reason" 
                          Width="200"
                          AllowEditing="True"
                          CellStyle="{StaticResource MissedStartReasonRequiredStyle}"/>

                <syncfusion:GridTextColumn MappingName="MissedFinishReason" 
                          HeaderText="Missed Finish Reason" 
                          Width="200"
                          AllowEditing="True"
                          CellStyle="{StaticResource MissedFinishReasonRequiredStyle}"/>

                <syncfusion:GridDateTimeColumn MappingName="ThreeWeekStart" 
                              HeaderText="3WLA Start" 
                              Width="110"
                              AllowEditing="True"
                              AllowNullValue="True"
                              NullText=""
                              Pattern="ShortDate"
                              CellStyle="{StaticResource ThreeWeekStartRequiredStyle}"/>

                <syncfusion:GridDateTimeColumn MappingName="ThreeWeekFinish" 
                              HeaderText="3WLA Finish" 
                              Width="110"
                              AllowEditing="True"
                              AllowNullValue="True"
                              NullText=""
                              Pattern="ShortDate"
                              CellStyle="{StaticResource ThreeWeekFinishRequiredStyle}"/>
            </syncfusion:SfDataGrid.Columns>
        </syncfusion:SfDataGrid>

        <!-- STATUS BAR -->
        <Border Grid.Row="2"
                Background="{StaticResource ToolbarBackground}"
                BorderBrush="{StaticResource ControlBorder}"
                BorderThickness="0,1,0,0"
                Height="30">
            <StackPanel Orientation="Horizontal" 
                       Margin="15,0"
                       VerticalAlignment="Center">
                <TextBlock x:Name="txtStatus"
                          Text="Ready"
                          Foreground="{StaticResource ForegroundColor}"
                          FontSize="12"/>
                <Button x:Name="btnRequiredFields"
                        Content="{Binding RequiredFieldsButtonText}"
                        Click="btnRequiredFields_Click"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource StatusRed}"
                        BorderBrush="{StaticResource ControlBorder}"
                        BorderThickness="1"
                        Padding="8,4"
                        Margin="20,0,0,0"
                        FontSize="11"
                        ToolTip="Click to filter rows with required fields"/>
            </StackPanel>
        </Border>

        <!-- LOADING OVERLAY -->
        <Grid Grid.Row="1"
              Background="#CC000000"
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
              Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center"
                       VerticalAlignment="Center">
                <syncfusion:SfBusyIndicator IsBusy="True"
                                           AnimationType="DualRing"
                                           ViewboxWidth="80"
                                           ViewboxHeight="80"
                                           Foreground="{StaticResource AccentColor}"/>
                <TextBlock Text="Loading schedule data..."
                          FontSize="16"
                          Foreground="White"
                          HorizontalAlignment="Center"
                          Margin="0,20,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>