<UserControl x:Class="VANTAGE.Views.ProgressView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1200"
             Background="{StaticResource BackgroundColor}">

    <UserControl.Resources>
        <!-- Column Header with Filter Button -->
        <DataTemplate x:Key="FilterableColumnHeader">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" 
                       Text="{Binding}" 
                       VerticalAlignment="Center"
                       Foreground="{StaticResource ForegroundColor}"/>

                <Button Grid.Column="1"
                        Content="▼"
                        Width="20"
                        Height="20"
                        Margin="5,0,0,0"
                        Click="FilterButton_Click"
                        Tag="{Binding}"
                        ToolTip="Filter this column"
                        Cursor="Hand">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <TextBlock Text="{TemplateBinding Content}"
                                       Foreground="{StaticResource ForegroundColor}"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Background="Transparent"/>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="175"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEFT SIDEBAR: Quick Filters & Controls -->
        <Border Grid.Column="0" 
                Background="{StaticResource SidebarBackground}" 
                BorderBrush="{StaticResource SidebarBorder}" 
                BorderThickness="0,0,1,0"
                Padding="10">
            <StackPanel>
                <TextBlock Text="QUICK FILTERS" 
                           FontSize="12" 
                           FontWeight="Bold"
                           Foreground="{StaticResource TextColorSecondary}"
                           Margin="0,0,0,10"/>

                <Button x:Name="btnFilterComplete"
                        Content="Complete"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterComplete_Click"/>

                <Button x:Name="btnFilterNotComplete"
                        Content="Not Complete"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterNotComplete_Click"/>

                <Button x:Name="btnFilterPipe"
                        Content="USER 1"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterUser1_Click"/>

                <Button x:Name="btnFilterSteel"
                        Content="USER 2"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterUser2_Click"/>

                <Button x:Name="btnFilterElec"
                        Content="USER 3"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterUser3_Click"/>

                <Button x:Name="btnFilterMyRecords"
                        Content="My Records"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterMyRecords_Click"/>

                <Button x:Name="btnClearFilters"
                        Content="Clear Filters"
                        Height="35"
                        Margin="0,20,0,0"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource AccentColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Center"
                        Padding="10,0"
                        Click="BtnClearFilters_Click"/>

                <Border Height="1" 
                        Background="{StaticResource BorderColor}" 
                        Margin="0,20,0,20"/>

                <TextBlock Text="COLUMN VISIBILITY" 
                           FontSize="12" 
                           FontWeight="Bold"
                           Foreground="{StaticResource TextColorSecondary}"
                           Margin="0,0,0,10"/>

                <ListBox x:Name="lstColumnVisibility"
                         Height="200"
                         Background="{StaticResource ControlBackground}"
                         Foreground="{StaticResource ForegroundColor}"
                         BorderBrush="{StaticResource BorderColor}"
                         BorderThickness="1"
                         SelectionMode="Multiple"
                         SelectionChanged="LstColumnVisibility_SelectionChanged">
                </ListBox>

                <TextBlock Text="Select columns to show/hide" 
                           FontSize="10" 
                           Foreground="{StaticResource DisabledColor}"
                           Margin="0,5,0,0"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <!-- RIGHT SIDE: DataGrid -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/> <!-- Row 0: Filters/toolbar -->
                <RowDefinition Height="Auto"/> <!-- Row 1: ADD THIS - Summary panel -->
                <RowDefinition Height="*"/> <!-- Row 2: DataGrid (was Row 1) -->
                <RowDefinition Height="40"/> <!-- Row 3: Paging (was Row 2) -->
            </Grid.RowDefinitions>

            <!-- Combined Toolbar + Summary Panel -->
            <Border Grid.Row="0"
                    Background="{StaticResource ToolbarBackground}"
                    BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,0,0,1"
                    Padding="10,0">
                <DockPanel LastChildFill="True" VerticalAlignment="Center">

                    <!-- LEFT SIDE: Search controls -->
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                        <TextBlock Text="Search:"
                                   Foreground="{StaticResource TextColorSecondary}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>
                        <TextBox x:Name="txtSearch"
                                 Width="250"
                                 Height="25"
                                 Background="{StaticResource ControlBackground}"
                                 Foreground="{StaticResource ForegroundColor}"
                                 BorderBrush="{StaticResource BorderColor}"
                                 BorderThickness="1"
                                 Padding="5"
                                 VerticalContentAlignment="Center"
                                 TextChanged="TxtSearch_TextChanged"/>

                        <Button x:Name="btnRefresh"
                                Content="Refresh"
                                Width="80"
                                Height="28"
                                Margin="20,0,0,0"
                                Background="{StaticResource ControlBackground}"
                                Foreground="{StaticResource ForegroundColor}"
                                BorderBrush="{StaticResource BorderColor}"
                                BorderThickness="1"
                                Click="BtnRefresh_Click"/>

                        <TextBlock x:Name="txtFilteredCount"
                                   Text="0 records"
                                   Foreground="{StaticResource TextColorSecondary}"
                                   VerticalAlignment="Center"
                                   Margin="20,0,0,0"/>
                    </StackPanel>

                    <!-- RIGHT SIDE: Summary stats -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                        <!-- Budgeted MHs -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,30,0">
                            <TextBlock Text="Budgeted MHs:"
                           Foreground="{StaticResource TextColorSecondary}"
                           FontSize="14"
                           VerticalAlignment="Center"/>
                            <TextBlock x:Name="txtBudgetedMHs"
                           Text="0.00"
                           Foreground="{StaticResource AccentColor}"
                           FontSize="16"
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           Margin="5,0,0,0"/>
                        </StackPanel>

                        <!-- Earned MHs -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,30,0">
                            <TextBlock Text="Earned MHs:"
                           Foreground="{StaticResource TextColorSecondary}"
                           FontSize="14"
                           VerticalAlignment="Center"/>
                            <TextBlock x:Name="txtEarnedMHs"
                           Text="0.00"
                           Foreground="{StaticResource StatusGreen}"
                           FontSize="16"
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           Margin="5,0,0,0"/>
                        </StackPanel>

                        <!-- Percent Complete -->
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Percent Complete:"
                           Foreground="{StaticResource TextColorSecondary}"
                           FontSize="14"
                           VerticalAlignment="Center"/>
                            <TextBlock x:Name="txtPercentComplete"
                           Text="0.00%"
                           Foreground="{StaticResource StatusInProgress}"
                           FontSize="16"
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           Margin="5,0,0,0"/>
                        </StackPanel>
                    </StackPanel>

                </DockPanel>
            </Border>

            <!-- DataGrid with VIRTUALIZATION ENABLED -->
            <Border Grid.Row="2" 
                    BorderBrush="{StaticResource BorderColor}" 
                    BorderThickness="0">
                <DataGrid x:Name="dgActivities"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="True"
                          CanUserSortColumns="False"
                          SelectionMode="Extended"
                          SelectionUnit="FullRow"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="True"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          Background="{StaticResource BackgroundColor}"
                          Foreground="{StaticResource ForegroundColor}"
                          BorderBrush="{StaticResource BorderColor}"
                          BorderThickness="0"
                          GridLinesVisibility="All"
                          HorizontalGridLinesBrush="{StaticResource BorderColor}"
                          VerticalGridLinesBrush="{StaticResource BorderColor}"
                          RowHeight="28"
                          HeadersVisibility="Column"
                          RowEditEnding="DgActivities_RowEditEnding"
                          SelectionChanged="DgActivities_SelectionChanged"
                          BeginningEdit="DgActivities_BeginningEdit">

                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="{StaticResource GridHeaderBackground}"/>
                            <Setter Property="Foreground" Value="{StaticResource GridHeaderForeground}"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="Padding" Value="8,5"/>
                            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
                            <Setter Property="BorderThickness" Value="0,0,1,1"/>
                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
                            <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
                            <Style.Triggers>
                                <!-- Green background for my records (editable) -->
                                <DataTrigger Binding="{Binding IsMyRecord}" Value="True">
                                    <Setter Property="Background" Value="{StaticResource MyRecordsBackground}"/>
                                </DataTrigger>

                                <!-- Grey background/text for non-editable records -->
                                <DataTrigger Binding="{Binding IsEditable}" Value="False">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </DataTrigger>

                                <!-- Selected row (overrides other backgrounds) -->
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{StaticResource GridSelectedRowBackground}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
                            <Setter Property="BorderThickness" Value="0,0,1,0"/>
                            <Setter Property="Padding" Value="5,0"/>
                            <Style.Triggers>
                                <!-- Selected cell styling -->
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{StaticResource GridSelectedRowBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.CellStyle>

                    <DataGrid.ContextMenu>
                        <ContextMenu Background="{StaticResource ControlBackground}" 
                                     Foreground="{StaticResource ForegroundColor}"
                                     BorderBrush="{StaticResource BorderColor}">
                            <MenuItem Header="Assign to Me" 
                                      Click="MenuAssignToMe_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <MenuItem Header="Assign to User..." 
                                      Click="MenuAssignToUser_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <MenuItem Header="Unassign" 
                                      Click="MenuUnassign_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <Separator Background="{StaticResource BorderColor}"/>
                            <MenuItem Header="Mark Complete (100%)" 
                                      Click="MenuMarkComplete_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <MenuItem Header="Mark Not Started (0%)" 
                                      Click="MenuMarkNotStarted_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>

                    <DataGrid.Columns>
                        <DataGridTextColumn Binding="{Binding UniqueID}" Width="120" IsReadOnly="True">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="UniqueID" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Description}" Width="250">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Description" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding CompType}" Width="120">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="CompType" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding PhaseCategory}" Width="120">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="PhaseCategory" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ROCStep}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="ROCStep" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ProjectID}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="ProjectID" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding WorkPackage}" Width="120">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="WorkPackage" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding PhaseCode}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="PhaseCode" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding DwgNO}" Width="120">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="DwgNO" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTemplateColumn Width="120">
                            <DataGridTemplateColumn.Header>
                                <ContentControl Content="SchStart" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTemplateColumn.Header>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding SchStart, StringFormat=yyyy-MM-dd}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <DatePicker SelectedDate="{Binding SchStart, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Width="120">
                            <DataGridTemplateColumn.Header>
                                <ContentControl Content="SchFinish" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTemplateColumn.Header>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding SchFinish, StringFormat=yyyy-MM-dd}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <DatePicker SelectedDate="{Binding SchFinish, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Width="120" Visibility="Collapsed">
                            <DataGridTemplateColumn.Header>
                                <ContentControl Content="ProgDate" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTemplateColumn.Header>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding ProgDate, StringFormat=yyyy-MM-dd}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <DatePicker SelectedDate="{Binding ProgDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Width="120" Visibility="Collapsed">
                            <DataGridTemplateColumn.Header>
                                <ContentControl Content="WeekEndDate" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTemplateColumn.Header>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding WeekEndDate, StringFormat=yyyy-MM-dd}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <DatePicker SelectedDate="{Binding WeekEndDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Binding="{Binding SchedActNO}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="SchedActNO" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Quantity, StringFormat=N2}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Quantity" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding EarnQtyEntry, StringFormat=N2, UpdateSourceTrigger=LostFocus}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="EarnQtyEntry" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding PercentEntry_Display, StringFormat=N2}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="PercentEntry" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding BudgetMHs, StringFormat=N2}" Width="100">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="BudgetMHs" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding EarnMHsCalc, StringFormat=N3}" Width="100" IsReadOnly="True">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="EarnMHsCalc" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Status}" Width="100" IsReadOnly="True">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Status" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding UDF1}" Width="120">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="UDF1" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding UDF2}" Width="120">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="UDF2" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding AssignedTo}" IsReadOnly="True" Width="120">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="AssignedTo" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- ALL OTHER COLLAPSED COLUMNS -->
                        <DataGridTextColumn Binding="{Binding HexNO}" Width="80" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="HexNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <!-- Drawings -->
                        <DataGridTextColumn Binding="{Binding RevNO}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="RevNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding SecondDwgNO}" Width="120" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="SecondDwgNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ShtNO}" Width="80" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="ShtNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <!-- Notes -->
                        <DataGridTextColumn Binding="{Binding Notes}" Width="200" Visibility="Visible">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Notes" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <!-- Schedule Additional -->
                        <DataGridTextColumn Binding="{Binding SecondActno}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="SecondActno" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <!-- Tags - Auxiliary -->
                        <DataGridTextColumn Binding="{Binding Aux1}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Aux1" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Aux2}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Aux2" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Aux3}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Aux3" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Area}" Width="80" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Area" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ChgOrdNO}" Width="80" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="ChgOrdNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding EqmtNO}" Width="120" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="EqmtNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Estimator}" Width="120" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Estimator" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding InsulType}" Width="120" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="InsulType" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding LineNO}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="LineNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding MtrlSpec}" Width="120" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="MtrlSpec" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding PaintCode}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="PaintCode" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding PipeGrade}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="PipeGrade" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding RFINO}" Width="80" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="RFINO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding Service}" Width="120" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="Service" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ShopField}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="ShopField" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding SubArea}" Width="80" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="SubArea" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding System}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="System" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding SystemNO}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="SystemNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding TagNO}" Width="120" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="TagNO" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding HtTrace}" Width="100" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="HtTrace" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding XRay, StringFormat=N2}" Width="80" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="XRay" ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>

                        <!-- Trigger -->
                        <DataGridTextColumn Binding="{Binding DateTrigger}" Width="100" Visibility="Collapsed"/>

                        <!-- UDF Fields (remaining) -->
                        <DataGridTextColumn Binding="{Binding UDF3}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF4}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF5}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF6}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF7}" Width="80" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF8}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF9}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF10}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding LastModifiedBy}" Width="150" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding CreatedBy}" Width="150" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF14}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF15}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF16}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF17}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF18}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UDF20}" Width="120" Visibility="Collapsed"/>

                        <!-- Values - Additional -->
                        <DataGridTextColumn Binding="{Binding BaseUnit, StringFormat=N2}" Width="100" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding BudgetHoursGroup, StringFormat=N2}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding BudgetHoursROC, StringFormat=N2}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding EarnedMHsRoc}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding UOM}" Width="80" Visibility="Collapsed"/>

                        <!-- Calculated fields -->
                        <DataGridTextColumn Binding="{Binding EarnedQtyCalc_Display, StringFormat=N2}" Width="100" IsReadOnly="True" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="EarnedQtyCalc" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding PercentCompleteCalc_Display, StringFormat=N2}" Width="100" IsReadOnly="True" Visibility="Collapsed">
                            <DataGridTextColumn.Header>
                                <ContentControl Content="PercentCompleteCalc" 
                                                ContentTemplate="{StaticResource FilterableColumnHeader}"/>
                            </DataGridTextColumn.Header>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Equipment Quantity -->
                        <DataGridTextColumn Binding="{Binding EquivQTY, StringFormat=N2}" Width="100" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding EquivUOM}" Width="80" Visibility="Collapsed"/>

                        <!-- ROC -->
                        <DataGridTextColumn Binding="{Binding ROCID}" Width="80" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding ROCLookupID}" Width="200" IsReadOnly="True" Visibility="Collapsed">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ROCPercent, StringFormat=N2}" Width="100" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding ROCBudgetQTY, StringFormat=N2}" Width="120" Visibility="Collapsed"/>

                        <!-- Pipe -->
                        <DataGridTextColumn Binding="{Binding PipeSize1, StringFormat=N2}" Width="100" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding PipeSize2, StringFormat=N2}" Width="100" Visibility="Collapsed"/>

                        <!-- Previous Values -->
                        <DataGridTextColumn Binding="{Binding PrevEarnMHs, StringFormat=N2}" Width="120" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding PrevEarnQTY, StringFormat=N2}" Width="120" Visibility="Collapsed"/>

                        <!-- WeekEndDate -->
                        <DataGridTextColumn Binding="{Binding WeekEndDate}" Width="150" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding AzureUploadDate}" Width="150" Visibility="Collapsed" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ProgDate}" Width="150" Visibility="Collapsed" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Client Values -->
                        <DataGridTextColumn Binding="{Binding ClientEquivQty, StringFormat=N2}" Width="150" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding ClientBudget, StringFormat=N2}" Width="100" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding ClientCustom3, StringFormat=N2}" Width="100" Visibility="Collapsed"/>

                        <DataGridTextColumn Binding="{Binding ClientEquivEarnQTY, StringFormat=N3}" Width="150" IsReadOnly="True" Visibility="Collapsed">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ReadOnlyBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- PAGING CONTROLS (Bottom toolbar) -->
            <Border Grid.Row="3" 
                    Background="{StaticResource ToolbarBackground}" 
                    BorderBrush="{StaticResource BorderColor}" 
                    BorderThickness="0,1,0,0"
                    Padding="10,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Button x:Name="btnFirstPage"
                            Content="⏮ First"
                            Width="80"
                            Height="28"
                            Margin="5,0"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnFirstPage_Click"/>

                    <Button x:Name="btnPreviousPage"
                            Content="◀ Previous"
                            Width="90"
                            Height="28"
                            Margin="5,0"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnPreviousPage_Click"/>

                    <TextBlock x:Name="txtPageInfo"
                               Text="{Binding CurrentPageDisplay}"
                               Foreground="{StaticResource ForegroundColor}"
                               VerticalAlignment="Center"
                               Margin="20,0"
                               FontWeight="Bold"/>

                    <Button x:Name="btnNextPage"
                            Content="Next ▶"
                            Width="90"
                            Height="28"
                            Margin="5,0"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnNextPage_Click"/>

                    <Button x:Name="btnLastPage"
                            Content="Last ⏭"
                            Width="80"
                            Height="28"
                            Margin="5,0"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnLastPage_Click"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>