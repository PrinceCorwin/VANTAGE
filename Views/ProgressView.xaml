<UserControl x:Class="VANTAGE.Views.ProgressView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:svg="http://sharpvectors.codeplex.com/runtime/"
             xmlns:styles="clr-namespace:VANTAGE.Styles"
             mc:Ignorable="d"
             d:DesignHeight="1080" d:DesignWidth="1920"
             Background="{StaticResource BackgroundColor}">

    <UserControl.Resources>
        
        <Style x:Key="RoundedButtonStyle" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="15">
                            <ContentPresenter Content="{TemplateBinding Content}"
                                              HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ControlBorder}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <styles:RecordOwnershipRowStyleSelector x:Key="RowStyleSelector" />

        <!-- Base cell style to force consistent border thickness across all columns -->
        <Style TargetType="syncfusion:GridCell">
            <Setter Property="BorderThickness" Value="0,0,0.5,0.5"/>
            <Setter Property="Padding" Value="4,0,4,0"/>
        </Style>

        <!-- Style for empty/null required fields with red border -->
        <Style x:Key="CompTypeRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=CompType}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=CompType}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PhaseCategoryRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=PhaseCategory}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=PhaseCategory}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ProjectIDRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=HasInvalidProjectID}" Value="True">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="WorkPackageRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=WorkPackage}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=WorkPackage}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PhaseCodeRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=PhaseCode}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=PhaseCode}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ROCStepRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=ROCStep}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=ROCStep}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="DescRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=Description}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=Description}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="SchedActNoRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=SchedActNO}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=SchedActNO}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="RespPartyRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=RespParty}" Value="">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=RespParty}" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Conditional required date styles (depend on PercentEntry value) -->
        <Style x:Key="ActStartRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=HasMissingActStart}" Value="True">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ActFinRequiredStyle" TargetType="syncfusion:GridCell" BasedOn="{StaticResource {x:Type syncfusion:GridCell}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=HasMissingActFin}" Value="True">
                    <Setter Property="Background" Value="{StaticResource StatusRedBg}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="100"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEFT SIDEBAR: Quick Filters & Controls -->
        <Border Grid.Column="0" 
                BorderThickness="1"
                Padding="10,0,10,10"
                Background="{StaticResource DarkBackgroundColor}"
                BorderBrush="{StaticResource BorderColor}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Sidebar Controls -->
                <StackPanel Grid.Row="0">
                    <TextBlock Text="QUICK FILTERS" 
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontSize="11" 
                               FontWeight="Bold"
                               Height="30"
                               Padding="10"
                               Foreground="{StaticResource ForegroundColor}"
                               Margin="0,0,0,10"/>

                    <Button x:Name="btnFilterComplete"
                            Content="Complete"
                            Height="35"
                            Margin="0,0,0,5"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="BtnFilterComplete_Click"
                            ToolTip="Show only 100% complete activities"/>

                    <Button x:Name="btnFilterInProgress"
                            Content="In Progress"
                            Height="35"
                            Margin="0,0,0,5"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="btnFilterInProgress_Click"
                            ToolTip="Show activities between 1-99% complete"/>

                    <Button x:Name="btnFilterNotStarted"
                            Content="Not Started"
                            Height="35"
                            Margin="0,0,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="BtnFilterNotStarted_Click"
                            ToolTip="Show activities at 0% complete"/>

                    <Border Height="1" 
                        Background="{StaticResource ControlBorder}" 
                        Margin="0,10,0,10"/>

                    <Button x:Name="btnFilterLocalDirty"
                            Content="Unsynced"
                            Height="35"
                            Margin="0,0,0,5"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="BtnFilterLocalDirty_Click"
                            ToolTip="Show records with unsaved local changes"/>

                    <Button x:Name="btnFilterMyRecords"
                            Content="My Records"
                            Height="35"
                            Margin="0,0,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="BtnFilterMyRecords_Click"
                            ToolTip="Show only records assigned to me"/>

                    <Button x:Name="btnFilterToday"
                            Content="Today"
                            Height="35"
                            Margin="0,5,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="BtnFilterToday_Click"
                            ToolTip="Show activities scheduled to start or finish today"/>

                    <Button x:Name="btnUserFilters"
                            Height="35"
                            Margin="0,5,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="5,0"
                            FontSize="11"
                            Click="BtnUserFilters_Click"
                            ToolTip="Apply saved custom filters">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock x:Name="txtUserFilterName" Text="USER" VerticalAlignment="Center"/>
                            <TextBlock Text=" &#x25BC;" FontSize="8" VerticalAlignment="Center" Margin="3,1,0,0"/>
                        </StackPanel>
                        <Button.ContextMenu>
                            <ContextMenu x:Name="ctxUserFilters"
                                         Background="{StaticResource ControlBackground}"
                                         Foreground="{StaticResource ForegroundColor}"
                                         BorderBrush="{StaticResource ControlBorder}"
                                         BorderThickness="1"
                                         Padding="0">
                                <ContextMenu.ItemContainerStyle>
                                    <Style TargetType="MenuItem">
                                        <Setter Property="Background" Value="{StaticResource ControlBackground}"/>
                                        <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="MenuItem">
                                                    <Border x:Name="Border"
                                                            Background="{TemplateBinding Background}"
                                                            BorderThickness="0"
                                                            Padding="10,6">
                                                        <ContentPresenter ContentSource="Header"
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsHighlighted" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="{StaticResource ControlHoverBackground}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter Property="Foreground" Value="{StaticResource DisabledText}"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ContextMenu.ItemContainerStyle>
                                <!-- Items populated dynamically -->
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>

                    <Border Height="1"
                        Background="{StaticResource ControlBorder}"
                        Margin="0,10,0,10"/>

                    <Button x:Name="btnClearFilters"
                            Content="Clear Filters"
                            Height="35"
                            Margin="0,0,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="BtnClearFilters_Click"
                            ToolTip="Remove all active filters"/>

                    <Border Height="1" 
                        Background="{StaticResource ControlBorder}" 
                        Margin="0,10,0,10"/>

                    <Button x:Name="btnAssign"
                            Content="Assign"
                            
                            Height="28"
                            Margin="0,0,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            Padding="10,0"
                            FontSize="11"
                            VerticalContentAlignment="Center"
                            Click="MenuAssignToUser_Click"
                            ToolTip="Assign selected records to user"/>

                    <Border Height="1" 
                        Background="{StaticResource ControlBorder}" 
                        Margin="0,10,0,10"/>

                    <Button x:Name="btnColumnVisibility"
                            Content="Columns"
                            Height="35"
                            Margin="0,0,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource ControlBorder}"
                            BorderThickness="1"
                            HorizontalContentAlignment="Center"
                            Padding="10,0"
                            FontSize="11"
                            Click="BtnColumnVisibility_Click"
                            ToolTip="Show or hide grid columns"/>

                </StackPanel>
                <!-- Spacer (pushes logo to bottom) -->
                <Border Grid.Row="1" Height="20"/>
                <!-- Logo at the bottom -->
                <Border Grid.Row="3" 
                        Margin="0,0,0,0" 
                        Padding="0" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Bottom">
                    <Image Width="80" 
                           Source="pack://application:,,,/images/SummitLogoNoText.jpg" 
                           Stretch="Uniform" />
                </Border>
            </Grid>
        </Border>

        <!-- RIGHT SIDE: DataGrid -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <!-- Row 0: Toolbar -->
                <RowDefinition Height="Auto"/>
                <!-- Row 2: DataGrid-->
                <RowDefinition Height="*"/>
                <!-- Row 2: Footer-->
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Combined Toolbar + Summary Panel -->
            <Border Grid.Row="0"
                    BorderThickness="0,1,1,1"
                    Background="{StaticResource DarkBackgroundColor}"
                    BorderBrush="{StaticResource BorderColor}"
                    Padding="10,5">

                <Grid VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- LEFT SIDE: Refresh and Custom Percent Buttons -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center">

                        <!-- Global Search Box -->
                        <Border Background="{StaticResource ControlBackground}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                CornerRadius="15"
                                Margin="15,0,5,0"
                                Padding="4,2">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="🔍"
                                           FontSize="12"
                                           VerticalAlignment="Center"
                                           Margin="4,0,4,0"
                                           Foreground="{StaticResource TextColorSecondary}"/>
                                <TextBox x:Name="txtGlobalSearch"
                                         Grid.Column="1"
                                         Width="140"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Foreground="{StaticResource ForegroundColor}"
                                         CaretBrush="{StaticResource ForegroundColor}"
                                         VerticalContentAlignment="Center"
                                         FontSize="12"
                                         TextChanged="TxtGlobalSearch_TextChanged"
                                         ToolTip="Search all columns"/>
                                <Button x:Name="btnClearSearch"
                                        Grid.Column="2"
                                        Content="✕"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Foreground="{StaticResource TextColorSecondary}"
                                        FontSize="10"
                                        Padding="4,0"
                                        VerticalAlignment="Center"
                                        Cursor="Hand"
                                        Visibility="Collapsed"
                                        Click="BtnClearSearch_Click"
                                        ToolTip="Clear search"/>
                            </Grid>
                        </Border>

                        <Button x:Name="btnRefresh"
                                Content="REFRESH"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="80"
                                Margin="15,0,5,0"
                                Background="{StaticResource ControlBackground}"
                                Foreground="{StaticResource ForegroundColor}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                Padding="5"
                                FontSize="12"
                                VerticalContentAlignment="Center"
                                Click="BtnRefresh_Click"
                                ToolTip="Reload data from local database"/>

                        <Button x:Name="btnScanProgress"
                                Content="SCAN"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="60"
                                Margin="5,0"
                                Background="{StaticResource ControlBackground}"
                                Foreground="{StaticResource AccentColor}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                Padding="5"
                                FontSize="12"
                                VerticalContentAlignment="Center"
                                Click="BtnScanProgress_Click"
                                ToolTip="Scan progress sheets with AI vision"/>

                        <Button x:Name="btnSetPercent100"
                                Content="100%"
                                Style="{StaticResource RoundedButtonStyle}"
                                Tag="Button1|CustomPercentButton1|100"
                                Width="60"
                                Margin="5,0"
                                Background="{StaticResource ControlBackground}"
                                Foreground="{StaticResource ForegroundColor}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                Padding="5"
                                FontSize="12"
                                VerticalContentAlignment="Center"
                                Click="BtnSetPercent_Click"
                                ToolTip="Left-click: Apply | Right-click: Customize">
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Reset Button to 100%" Click="MenuItem_ResetPercent_Click" Tag="100"/>
                                    <Separator/>
                                    <MenuItem Header="Custom Percent..." Click="MenuItem_CustomPercent_Click"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>

                        <Button x:Name="btnSetPercent0"
                                Content="0%"
                                Style="{StaticResource RoundedButtonStyle}"
                                Tag="Button2|CustomPercentButton2|0"
                                Width="60"
                                Margin="5,0"
                                Background="{StaticResource ControlBackground}"
                                Foreground="{StaticResource ForegroundColor}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                Padding="5"
                                FontSize="12"
                                VerticalContentAlignment="Center"
                                Click="BtnSetPercent_Click"
                                ToolTip="Left-click: Apply | Right-click: Customize">
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Reset Button to 0%" Click="MenuItem_ResetPercent_Click" Tag="0"/>
                                    <Separator/>
                                    <MenuItem Header="Custom Percent..." Click="MenuItem_CustomPercent_Click"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                    </StackPanel>

                    <!-- CENTER: Sync and Submit Buttons -->
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="0,0,100,0"
                                VerticalAlignment="Center">

                        <Button x:Name="btnSync"
                                Content="SYNC"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="80"
                                Margin="10,0"
                                Background="{StaticResource ControlBackgroundGreen}"
                                Foreground="{StaticResource ActionButtonForeground}"
                                BorderBrush="{StaticResource TextColorSecondary}"
                                BorderThickness="2"
                                Padding="5"
                                FontSize="12"
                                VerticalContentAlignment="Center"
                                Click="BtnSync_Click"
                                ToolTip="Push local changes and pull updates from Azure"/>

                        <Button x:Name="btnSubmit"
                                Content="SUBMIT WEEK"
                                Style="{StaticResource RoundedButtonStyle}"
                                Width="150"
                                Margin="10,0"
                                Background="{StaticResource ControlBackgroundRed}"
                                Foreground="{StaticResource ActionButtonForeground}"
                                BorderBrush="{StaticResource TextColorSecondary}"
                                BorderThickness="2"
                                Padding="5"
                                FontSize="12"
                                VerticalContentAlignment="Center"
                                Click="BtnSubmit_Click"
                                ToolTip="Submit weekly progress and create snapshot"/>
                    </StackPanel>

                    <!-- RIGHT SIDE: Summary stats -->
                    <Viewbox Grid.Column="2" 
                             HorizontalAlignment="Right"
                             VerticalAlignment="Center"
                             StretchDirection="DownOnly"
                             MaxHeight="30">
                        <StackPanel Orientation="Horizontal">

                            <!-- Budget column selector and value -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0" ToolTip="Click to select column for summary calculations">
                                <TextBlock x:Name="SummaryColumnSelector"
                                           Text="{Binding SelectedSummaryColumn}"
                                           Foreground="{StaticResource TextColorSecondary}"
                                           FontSize="14"
                                           VerticalAlignment="Center"
                                           Cursor="Hand"
                                           MouseLeftButtonUp="SummaryColumnSelector_Click">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="TextDecorations" Value="Underline"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                    <TextBlock.ContextMenu>
                                        <ContextMenu x:Name="SummaryColumnMenu"
                                                     ItemsSource="{Binding AvailableSummaryColumns}"
                                                     MenuItem.Click="SummaryColumnMenuItem_Click"/>
                                    </TextBlock.ContextMenu>
                                </TextBlock>
                                <TextBlock Text=" ▾:"
                                           Foreground="{StaticResource TextColorSecondary}"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding BudgetedMHs, StringFormat=N2}"
                                           Foreground="{StaticResource AccentColor}"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Margin="5,0,0,0"/>
                            </StackPanel>

                            <!-- Earned MHs -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0" ToolTip="Earned Man-Hours">
                                <TextBlock Text="Earned:"
                                           Foreground="{StaticResource TextColorSecondary}"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding EarnedMHs, StringFormat=N2}"
                                           Foreground="{StaticResource StatusGreen}"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Margin="5,0,0,0"/>
                            </StackPanel>

                            <!-- Percent Complete -->
                            <StackPanel Orientation="Horizontal" ToolTip="Percent Complete">
                                <TextBlock Text="% Complete:"
                                           Foreground="{StaticResource TextColorSecondary}"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding PercentComplete, StringFormat='{}{0:N2}%'}"
                                           Foreground="{StaticResource StatusInProgress}"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Margin="5,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Viewbox>

                </Grid>
            </Border>

            <!-- DataGrid with VIRTUALIZATION ENABLED -->
            <Border Grid.Row="1" 
                    BorderBrush="{StaticResource ControlBorder}" 
                    BorderThickness="0">
                <syncfusion:SfDataGrid x:Name="sfActivities"
                    AutoGenerateColumns="False"
                    UseLayoutRounding="True"
                    SnapsToDevicePixels="True"
                    UseDrawing="Default"
                    AllowGrouping="True"
                    ShowGroupDropArea="True"
                    AllowEditing="True"
                    EditTrigger="OnTap"
                    AddNewRowPosition="None"
                    AllowDraggingColumns="True"
                    AllowResizingColumns="True"
                    AllowSorting="True"
                    AllowFiltering="True"
                    LiveDataUpdateMode="AllowSummaryUpdate"
                    SelectionMode="Extended"
                    SelectionUnit="Any"
                    ColumnSizer="Auto"
                    Background="{StaticResource BackgroundColor}"
                    Foreground="{StaticResource ForegroundColor}"
                    BorderBrush="{StaticResource ControlBorder}"
                    BorderThickness="0"
                    GridLinesVisibility="Both"
                    RowHeight="28"
                    HeaderRowHeight="32"
                    RowStyleSelector="{StaticResource RowStyleSelector}"
                    ShowRowHeader="True"
                    GridContextMenuOpening="sfActivities_GridContextMenuOpening"
                    CurrentCellEndEdit="sfActivities_CurrentCellEndEdit"
                    SelectionChanged="sfActivities_SelectionChanged"
                    CurrentCellBeginEdit="SfActivities_CurrentCellBeginEdit"
                    PreviewMouseWheel="SfActivities_PreviewMouseWheel">
                    <syncfusion:SfDataGrid.Resources>
                        <Style TargetType="syncfusion:GridHeaderCellControl">
                            <Setter Property="Background" Value="{StaticResource GridHeaderBackground}"/>
                            <Setter Property="Foreground" Value="{StaticResource GridHeaderForeground}"/>
                            <Setter Property="BorderThickness" Value="0,0,0.5,0.5"/>
                            <Setter Property="Padding" Value="4,0,4,0"/>
                        </Style>
                        <!-- Thicker scrollbars with accent color -->
                        <Style TargetType="ScrollBar">
                            <Style.Triggers>
                                <Trigger Property="Orientation" Value="Vertical">
                                    <Setter Property="Width" Value="14"/>
                                    <Setter Property="MinWidth" Value="14"/>
                                </Trigger>
                                <Trigger Property="Orientation" Value="Horizontal">
                                    <Setter Property="Height" Value="14"/>
                                    <Setter Property="MinHeight" Value="14"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                        <Style TargetType="Thumb">
                            <Setter Property="Background" Value="{DynamicResource ActiveFilterBorderColor}"/>
                        </Style>
                        <Style TargetType="syncfusion:FilterToggleButton">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="syncfusion:FilterToggleButton">
                                        <Grid SnapsToDevicePixels="True" Background="Transparent">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroup x:Name="FilterStates">
                                                    <VisualState x:Name="Filtered">
                                                        <Storyboard>
                                                            <ColorAnimation Storyboard.TargetName="IconStroke"
                                                                            Storyboard.TargetProperty="Color"
                                                                            To="{StaticResource FilterIconActiveColor}"
                                                                            Duration="0:0:0.3"/>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="UnFiltered">
                                                        <Storyboard>
                                                            <ColorAnimation Storyboard.TargetName="IconStroke"
                                                                            Storyboard.TargetProperty="Color"
                                                                            To="{StaticResource FilterIconColor}"
                                                                            Duration="0:0:0.3"/>
                                                        </Storyboard>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateManager.VisualStateGroups>
                                            <Path Data="M 1,2 L 11,2 L 7,6 L 7,10 L 5,10 L 5,6 Z"
                                                  Stretch="Uniform" Width="10" Height="10"
                                                  StrokeThickness="1.2" Fill="Transparent" Margin="3">
                                                <Path.Stroke>
                                                    <SolidColorBrush x:Name="IconStroke" Color="{StaticResource FilterIconColor}"/>
                                                </Path.Stroke>
                                            </Path>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                        <Style TargetType="syncfusion:GridCell">
                            <Setter Property="BorderThickness" Value="0,0,0.5,0.5"/>
                            <Setter Property="Padding" Value="4,0,4,0"/>
                        </Style>
                    </syncfusion:SfDataGrid.Resources>

                    <syncfusion:SfDataGrid.RecordContextMenu>
                        <ContextMenu
                             Background="{StaticResource ControlBackground}"
                             Foreground="{StaticResource ForegroundColor}"
                             BorderBrush="{StaticResource ControlBorder}">

                            <!-- Select All Filtered Rows -->
                            <MenuItem Header="Select All"
                                      Click="MenuSelectAll_Click"
                                      ToolTip="Select all filtered rows (Ctrl+A)"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}">
                                <MenuItem.Icon>
                                    <TextBlock Text="☑" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>

                            <Separator/>

                            <!-- Delete Row(s) -->
                            <MenuItem Header="Delete Row(s)"
                                      Click="DeleteSelectedActivities_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ErrorText}">
                                <MenuItem.Icon>
                                    <TextBlock Text="🗑️" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>

                            <!-- Placeholder 1 -->
                            <MenuItem Header="Copy Row(s)"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}">
                                <MenuItem.Icon>
                                    <TextBlock Text="📋" FontSize="14"/>
                                </MenuItem.Icon>
                                <MenuItem Header="Copy (Visible Columns)"
                                          Click="MenuCopyVisibleColumns_Click"
                                          Background="{StaticResource ControlBackground}"
                                          Foreground="{StaticResource ForegroundColor}"/>
                                <MenuItem Header="Copy (All Columns)"
                                          Click="MenuCopyAllColumns_Click"
                                          Background="{StaticResource ControlBackground}"
                                          Foreground="{StaticResource ForegroundColor}"/>
                            </MenuItem>

                            <!-- Placeholder 2 -->
                            <MenuItem Header="Duplicate Row(s)"
                                      Click="MenuDuplicateRows_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"
                                      IsEnabled="True">
                                <MenuItem.Icon>
                                    <TextBlock Text="➕" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>

                            <!-- Add Blank Row -->
                            <MenuItem Header="Add Blank Row"
                                      Click="MenuAddBlankRow_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"
                                      ToolTip="Create a new blank activity row assigned to you">
                                <MenuItem.Icon>
                                    <TextBlock Text="📝" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>

                            <!-- Placeholder 3 -->
                            <MenuItem Header="Export Selected"
                                      Click="MenuExportSelected_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"
                                      IsEnabled="True">
                                <MenuItem.Icon>
                                    <TextBlock Text="📤" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>

                        </ContextMenu>
                    </syncfusion:SfDataGrid.RecordContextMenu>
                    <syncfusion:SfDataGrid.HeaderContextMenu>
                        <ContextMenu Background="{StaticResource ControlBackground}"
                                     Foreground="{StaticResource ForegroundColor}"
                                     BorderBrush="{StaticResource ControlBorder}">
                            <MenuItem Header="Find &amp; Replace in this column..."
                                      Click="MenuFindReplaceColumn_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}">
                                <MenuItem.Icon>
                                    <TextBlock Text="🔍" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <Separator Background="{StaticResource ControlBorder}"/>
                            <MenuItem Header="Copy Column w/ Header"
                                      Click="MenuCopyColumnWithHeader_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"
                                      ToolTip="Copy all visible values in this column with header">
                                <MenuItem.Icon>
                                    <TextBlock Text="📋" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Copy Column w/o Header"
                                      Click="MenuCopyColumnWithoutHeader_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"
                                      ToolTip="Copy all visible values in this column without header">
                                <MenuItem.Icon>
                                    <TextBlock Text="📄" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <Separator Background="{StaticResource ControlBorder}"/>
                            <MenuItem Header="Freeze Columns to Here"
                                      Click="MenuFreezeColumnsToHere_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"
                                      ToolTip="Freeze this column and all columns to its left">
                                <MenuItem.Icon>
                                    <TextBlock Text="📌" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Unfreeze All Columns"
                                      Click="MenuUnfreezeAllColumns_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"
                                      ToolTip="Remove all frozen columns">
                                <MenuItem.Icon>
                                    <TextBlock Text="📍" FontSize="14"/>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </syncfusion:SfDataGrid.HeaderContextMenu>
                    <syncfusion:SfDataGrid.Columns>

                        <!-- IDENTITY & KEY FIELDS -->
                        <syncfusion:GridTextColumn MappingName="UniqueID"
                              HeaderText="UniqueID" Padding="4,0,4,0"
                              Width="120"
                              AllowEditing="False"
                              AllowFiltering="True"
                              AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="ActivityID"
                              HeaderText="ActivityID" Padding="4,0,4,0"
                              Width="80"
                              IsHidden="False"
                              AllowEditing="False"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="0" />

                        <syncfusion:GridTextColumn MappingName="ProjectID"
                              HeaderText="ProjectID"
                              Padding="4,0,4,0"
                              Width="100"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" 
                              CellStyle="{StaticResource ProjectIDRequiredStyle}"/>

                        <syncfusion:GridTextColumn MappingName="AssignedTo"
                              HeaderText="AssignedTo"
                              Padding="4,0,4,0"
                              Width="120"
                              AllowEditing="False"
                              AllowFiltering="True"
                              AllowSorting="True" />
                        
                        <syncfusion:GridTextColumn MappingName="CompType"
                              HeaderText="CompType"
                              Padding="4,0,4,0"
                              Width="120"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" 
                              CellStyle="{StaticResource CompTypeRequiredStyle}" />

                        <syncfusion:GridTextColumn MappingName="PhaseCategory"
                              HeaderText="PhaseCategory"
                              Padding="4,0,4,0"
                              Width="120"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              CellStyle="{StaticResource PhaseCategoryRequiredStyle}" />

                        <syncfusion:GridTextColumn MappingName="ROCStep"
                              HeaderText="ROCStep"
                              Padding="4,0,4,0"
                              Width="100"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" 
                              CellStyle="{StaticResource ROCStepRequiredStyle}"/>

                        <syncfusion:GridTextColumn MappingName="Description"
                              HeaderText="Description"
                              Padding="4,0,4,0"
                              Width="250"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" 
                              CellStyle="{StaticResource DescRequiredStyle}"/>

                        <syncfusion:GridNumericColumn MappingName="EarnQtyEntry"
                                 HeaderText="EarnQtyEntry"
                                 Padding="4,0,4,0"
                                 Width="100"
                                 AllowEditing="True"
                                 AllowFiltering="True"
                                 AllowSorting="True"
                                 NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="Quantity"
                                 HeaderText="Quantity"
                                 Padding="4,0,4,0"
                                 Width="100"
                                 AllowEditing="True"
                                 AllowFiltering="True"
                                 AllowSorting="True"/>

                        <syncfusion:GridNumericColumn MappingName="EarnedQtyCalc"
                                 HeaderText="EarnedQtyCalc"
                                 Padding="4,0,4,0"
                                 Width="100"
                                 AllowEditing="False"
                                 AllowFiltering="True"
                                 AllowSorting="True"
                                 NumberDecimalDigits="3" />

                        <syncfusion:GridTextColumn MappingName="PercentEntry"
                                 HeaderText="PercentEntry"
                                 Padding="4,0,4,0"
                                 Width="100"
                                 AllowEditing="True"
                                 AllowFiltering="True"
                                 AllowSorting="True"/>

                        <syncfusion:GridNumericColumn MappingName="PercentCompleteCalc"
                                 HeaderText="PercentCompleteCalc"
                                 Padding="4,0,4,0"
                                 Width="100"
                                 AllowEditing="False"
                                 AllowFiltering="True"
                                 AllowSorting="True"
                                 NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="BudgetMHs"
                                 HeaderText="BudgetMHs"
                                 Padding="4,0,4,0"
                                 Width="100"
                                 AllowEditing="True"
                                 AllowFiltering="True"
                                 AllowSorting="True"/>

                        <syncfusion:GridNumericColumn MappingName="EarnMHsCalc"
                                 HeaderText="EarnMHsCalc"
                                 Padding="4,0,4,0"
                                 Width="100"
                                 AllowEditing="False"
                                 AllowFiltering="True"
                                 AllowSorting="True"
                                 NumberDecimalDigits="3" />

                        <syncfusion:GridTextColumn MappingName="WorkPackage"
                              HeaderText="WorkPackage"
                              Padding="4,0,4,0"
                              Width="120"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" 
                              CellStyle="{StaticResource WorkPackageRequiredStyle}"/>

                        <syncfusion:GridTextColumn MappingName="PhaseCode"
                              HeaderText="PhaseCode"
                              Padding="4,0,4,0"
                              Width="100"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" 
                              CellStyle="{StaticResource PhaseCodeRequiredStyle}"/>

                        <syncfusion:GridTextColumn MappingName="SchedActNO"
                              HeaderText="SchedActNO"
                              Padding="4,0,4,0"
                              Width="100"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" 
                              CellStyle="{StaticResource SchedActNoRequiredStyle}"/>

                        <syncfusion:GridTextColumn MappingName="DwgNO"
                              HeaderText="DwgNO"
                              Padding="4,0,4,0"
                              Width="120"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True" />

                        <!-- ALPHABETICALLY SORTED XAML COLUMNS BY NAME -->
                        <!-- All original properties preserved -->

                        <syncfusion:GridDateTimeColumn MappingName="ActStart"
                           HeaderText="ActStart" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="False"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True"
                           AllowNullValue="True"
                           NullText=""
                           Pattern="ShortDate"
                           CellStyle="{StaticResource ActStartRequiredStyle}" />

                        <syncfusion:GridDateTimeColumn MappingName="ActFin"
                            HeaderText="ActFin" Padding="4,0,4,0"
                            Width="100"
                            IsHidden="False"
                            AllowEditing="True"
                            AllowFiltering="True"
                            AllowSorting="True"
                            AllowNullValue="True"
                            NullText=""
                            Pattern="ShortDate"
                            CellStyle="{StaticResource ActFinRequiredStyle}" />
                        <syncfusion:GridTextColumn MappingName="Area"
                           HeaderText="Area" Padding="4,0,4,0"
                           Width="80"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="Aux1"
                           HeaderText="Aux1" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="Aux2"
                           HeaderText="Aux2" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="Aux3"
                           HeaderText="Aux3" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridDateTimeColumn MappingName="AzureUploadUtcDate"
                               HeaderText="AzureUploadUtcDate" Padding="4,0,4,0"
                               Width="120"
                               IsHidden="True"
                               AllowEditing="False"
                               AllowFiltering="True"
                               AllowSorting="True"
                               Pattern="ShortDate" />

                        <syncfusion:GridNumericColumn MappingName="BaseUnit"
                              HeaderText="BaseUnit" Padding="4,0,4,0"
                              Width="100"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridNumericColumn MappingName="BudgetHoursGroup"
                              HeaderText="BudgetHoursGroup" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridNumericColumn MappingName="BudgetHoursROC"
                              HeaderText="BudgetHoursROC" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="ChgOrdNO"
                           HeaderText="ChgOrdNO" Padding="4,0,4,0"
                           Width="80"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="ClientBudget"
                              HeaderText="ClientBudget" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"/>

                        <syncfusion:GridNumericColumn MappingName="ClientCustom3"
                              HeaderText="ClientCustom3" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="ClientEquivEarnQTY"
                           HeaderText="ClientEquivEarnQTY" Padding="4,0,4,0"
                           Width="150"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="ClientEquivQty"
                              HeaderText="ClientEquivQty" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="CreatedBy"
                           HeaderText="CreatedBy" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="False"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="DateTrigger"
                              HeaderText="DateTrigger" Padding="4,0,4,0"
                              Width="100"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="0" />

                        <syncfusion:GridNumericColumn MappingName="EarnedMHsRoc"
                              HeaderText="EarnedMHsRoc" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="EqmtNO"
                           HeaderText="EqmtNO" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="EquivQTY"
                           HeaderText="EquivQTY" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="EquivUOM"
                           HeaderText="EquivUOM" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="Estimator"
                           HeaderText="Estimator" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="HexNO"
                              HeaderText="HexNO" Padding="4,0,4,0"
                              Width="80"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="0" />

                        <syncfusion:GridTextColumn MappingName="HtTrace"
                           HeaderText="HtTrace" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="InsulType"
                           HeaderText="InsulType" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="LineNumber"
                           HeaderText="LineNumber" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="LocalDirty"
                              HeaderText="LocalDirty" Padding="4,0,4,0"
                              Width="100"
                              IsHidden="False"
                              AllowEditing="False"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="0" />

                        <syncfusion:GridTextColumn MappingName="MtrlSpec"
                           HeaderText="MtrlSpec" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="Notes"
                           HeaderText="Notes" Padding="4,0,4,0"
                           Width="200"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="PaintCode"
                           HeaderText="PaintCode" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="PipeGrade"
                           HeaderText="PipeGrade" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="PipeSize1"
                              HeaderText="PipeSize1" Padding="4,0,4,0"
                              Width="100"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridNumericColumn MappingName="PipeSize2"
                              HeaderText="PipeSize2" Padding="4,0,4,0"
                              Width="100"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="PjtSystem"
                           HeaderText="PjtSystem" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />
                        <syncfusion:GridDateTimeColumn MappingName="PlanStart"
                             HeaderText="PlanStart" Padding="4,0,4,0"
                             Width="100"
                             IsHidden="False"
                             AllowEditing="True"
                             AllowFiltering="True"
                             AllowSorting="True"
                             AllowNullValue="True"
                             NullText=""
                             Pattern="ShortDate"
                             ToolTipService.ToolTip="Planned start date (populated from 3-week lookahead)" />

                        <syncfusion:GridDateTimeColumn MappingName="PlanFin"
                            HeaderText="PlanFin" Padding="4,0,4,0"
                            Width="100"
                            IsHidden="False"
                            AllowEditing="True"
                            AllowFiltering="True"
                            AllowSorting="True"
                            AllowNullValue="True"
                            NullText=""
                            Pattern="ShortDate"
                            ToolTipService.ToolTip="Planned finish date (populated from 3-week lookahead)" />

                        <syncfusion:GridNumericColumn MappingName="PrevEarnMHs"
                              HeaderText="PrevEarnMHs" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridNumericColumn MappingName="PrevEarnQTY"
                              HeaderText="PrevEarnQTY" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="ProgDate"
                           HeaderText="ProgDate" Padding="4,0,4,0"
                           Width="150"
                           IsHidden="True"
                           AllowEditing="False"
                           AllowFiltering="True"
                           AllowSorting="True"
                           DisplayBinding="{Binding ProgDate, StringFormat='{}{0:MM/dd/yyyy hh:mm tt}'}" />

                        <syncfusion:GridTextColumn MappingName="RevNO"
                           HeaderText="RevNO" Padding="4,0,4,0"
                           Width="80"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="RFINO"
                           HeaderText="RFINO" Padding="4,0,4,0"
                           Width="80"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="ROCBudgetQTY"
                              HeaderText="ROCBudgetQTY" Padding="4,0,4,0"
                              Width="120"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridNumericColumn MappingName="ROCID"
                              HeaderText="ROCID" Padding="4,0,4,0"
                              Width="80"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="0" />

                        <syncfusion:GridTextColumn MappingName="ROCLookupID"
                           HeaderText="ROCLookupID" Padding="4,0,4,0"
                           Width="150"
                           IsHidden="True"
                           AllowEditing="False"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridNumericColumn MappingName="ROCPercent"
                              HeaderText="ROCPercent" Padding="4,0,4,0"
                              Width="100"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="2" />

                        <syncfusion:GridTextColumn MappingName="SecondActno"
                           HeaderText="SecondActno" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="SecondDwgNO"
                           HeaderText="SecondDwgNO" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="Service"
                           HeaderText="Service" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="ShopField"
                           HeaderText="ShopField" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="ShtNO"
                           HeaderText="ShtNO" Padding="4,0,4,0"
                           Width="80"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="Status"
                           HeaderText="Status" Padding="4,0,4,0"
                           Width="100"
                           AllowEditing="False"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="SubArea"
                           HeaderText="SubArea" Padding="4,0,4,0"
                           Width="80"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="SyncVersion"
                           HeaderText="Sync Version" Padding="4,0,4,0"
                           Width="120"
                           DisplayBinding="{Binding SyncVersion}"
                           IsHidden="False"
                           AllowEditing="False"
                           AllowFiltering="True"
                           TextAlignment="Right" />

                        <syncfusion:GridTextColumn MappingName="PjtSystemNo"
                           HeaderText="PjtSystemNo" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="TagNO"
                           HeaderText="TagNO" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF1"
                           HeaderText="UDF1" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="False"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF2"
                           HeaderText="UDF2" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="False"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF3"
                           HeaderText="UDF3" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF4"
                           HeaderText="UDF4" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF5"
                           HeaderText="UDF5" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF6"
                           HeaderText="UDF6" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="False"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF7"
                           HeaderText="UDF7" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF8"
                           HeaderText="UDF8" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF9"
                           HeaderText="UDF9" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF10"
                           HeaderText="UDF10" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF11"
                           HeaderText="UDF11" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF12"
                           HeaderText="UDF12" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF13"
                           HeaderText="UDF13" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF14"
                           HeaderText="UDF14" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF15"
                           HeaderText="UDF15" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF16"
                           HeaderText="UDF16" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UDF17"
                           HeaderText="UDF17" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="RespParty"
                           HeaderText="Resp Party" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="False"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True"
                           CellStyle="{StaticResource RespPartyRequiredStyle}" />

                        <syncfusion:GridTextColumn MappingName="UDF20"
                           HeaderText="UDF20" Padding="4,0,4,0"
                           Width="100"
                           IsHidden="True"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UOM"
                           HeaderText="UOM" Padding="4,0,4,0"
                           Width="80"
                           AllowEditing="True"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UpdatedBy"
                           HeaderText="UpdatedBy" Padding="4,0,4,0"
                           Width="120"
                           IsHidden="False"
                           AllowEditing="False"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridTextColumn MappingName="UpdatedUtcDateDisplay"
                           HeaderText="UpdatedUtcDate" Padding="4,0,4,0"
                           Width="160"
                           IsHidden="True"
                           AllowEditing="False"
                           AllowFiltering="True"
                           AllowSorting="True" />

                        <syncfusion:GridDateTimeColumn MappingName="WeekEndDate"
                               HeaderText="WeekEndDate" Padding="4,0,4,0"
                               Width="120"
                               IsHidden="True"
                               AllowEditing="False"
                               AllowFiltering="True"
                               AllowSorting="True"
                               Pattern="ShortDate" />

                        <syncfusion:GridNumericColumn MappingName="XRay"
                              HeaderText="XRay" Padding="4,0,4,0"
                              Width="80"
                              IsHidden="True"
                              AllowEditing="True"
                              AllowFiltering="True"
                              AllowSorting="True"
                              NumberDecimalDigits="0" />
                    </syncfusion:SfDataGrid.Columns>
                </syncfusion:SfDataGrid>
            </Border>

            <!-- BOTTOM TOOLBAR -->
            <Border Grid.Row="2" 
                    Background="{StaticResource ToolbarBackground}" 
                    BorderBrush="{StaticResource ControlBorder}" 
                    BorderThickness="0,1,0,0"
                    Padding="10,0">
                <DockPanel>
                    <!-- LEFT: Record count -->
                    <TextBlock x:Name="txtFilteredCount"
                           DockPanel.Dock="Left"
                           Text="0 records"
                           Foreground="{StaticResource TextColorSecondary}"
                           VerticalAlignment="Center"
                           Margin="10,0,0,0"/>
                    <!-- NEW: Metadata Errors Button -->
                    <Button x:Name="btnMetadataErrors"
                                DockPanel.Dock="Left"
                                Content="{Binding MetadataErrorButtonText}"
                                Click="BtnMetadataErrors_Click"
                                Background="{StaticResource ControlBackground}"
                                Foreground="{StaticResource StatusRed}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                Padding="8,4"
                                Margin="15,0,0,0"
                                VerticalAlignment="Center"
                                Cursor="Hand"
                                FontSize="11"
                                ToolTip="Click to view records with missing required metadata"/>

                    <syncfusion:SfLinearProgressBar x:Name="loadingProgressBar"
                         DockPanel.Dock="Right"
                         Width="200"
                         Height="8"
                         Margin="0,0,10,0"
                         IsIndeterminate="True"
                         ProgressColor="{StaticResource AccentColor}"
                         TrackColor="{StaticResource ControlBorder}"
                         Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                         ToolTip="Loading data"/>

                    <!-- Grid Navigation Buttons -->
                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Margin="0,0,15,0">
                        <Button x:Name="btnGoToFirst" Click="BtnGoToFirst_Click"
                                Width="20" Height="20" Padding="0"
                                Background="{StaticResource ControlBackground}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                ToolTip="Go to first row (Ctrl+↑)"
                                Cursor="Hand">
                            <Path Data="M0,6 L5,0 L10,6 Z"
                                  Fill="{StaticResource ForegroundColor}"
                                  Width="10" Height="6"
                                  Stretch="Uniform"/>
                        </Button>
                        <Button x:Name="btnGoToLast" Click="BtnGoToLast_Click"
                                Width="20" Height="20" Padding="0" Margin="4,0,0,0"
                                Background="{StaticResource ControlBackground}"
                                BorderBrush="{StaticResource ControlBorder}"
                                BorderThickness="1"
                                ToolTip="Go to last row (Ctrl+↓)"
                                Cursor="Hand">
                            <Path Data="M0,0 L5,6 L10,0 Z"
                                  Fill="{StaticResource ForegroundColor}"
                                  Width="10" Height="6"
                                  Stretch="Uniform"/>
                        </Button>
                    </StackPanel>

                    <Border/>
                </DockPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
    