<UserControl x:Class="VANTAGE.Views.ProgressView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1200"
             Background="{StaticResource BackgroundColor}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEFT SIDEBAR: Quick Filters & Controls -->
        <Border Grid.Column="0" 
                Background="{StaticResource SidebarBackground}" 
                BorderBrush="{StaticResource SidebarBorder}" 
                BorderThickness="0,0,1,0"
                Padding="10">
            <StackPanel>
                <TextBlock Text="QUICK FILTERS" 
                           FontSize="12" 
                           FontWeight="Bold"
                           Foreground="{StaticResource TextColorSecondary}"
                           Margin="0,0,0,10"/>

                <Button x:Name="btnFilterComplete"
                        Content="Complete"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterComplete_Click"/>

                <Button x:Name="btnFilterNotComplete"
                        Content="Not Complete"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterNotComplete_Click"/>

                <Button x:Name="btnFilterPipe"
                        Content="Pipe"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterPipe_Click"/>

                <Button x:Name="btnFilterSteel"
                        Content="Steel"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterSteel_Click"/>

                <Button x:Name="btnFilterElec"
                        Content="Elec"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterElec_Click"/>

                <Button x:Name="btnFilterMyRecords"
                        Content="My Records"
                        Height="35"
                        Margin="0,0,0,5"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Left"
                        Padding="10,0"
                        Click="BtnFilterMyRecords_Click"/>

                <Button x:Name="btnClearFilters"
                        Content="Clear All Filters"
                        Height="35"
                        Margin="0,20,0,0"
                        Background="{StaticResource ControlBackground}"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource AccentColor}"
                        BorderThickness="1"
                        HorizontalContentAlignment="Center"
                        Padding="10,0"
                        Click="BtnClearFilters_Click"/>

                <Border Height="1" 
                        Background="{StaticResource BorderColor}" 
                        Margin="0,20,0,20"/>

                <TextBlock Text="COLUMN VISIBILITY" 
                           FontSize="12" 
                           FontWeight="Bold"
                           Foreground="{StaticResource TextColorSecondary}"
                           Margin="0,0,0,10"/>

                <ListBox x:Name="lstColumnVisibility"
                         Height="200"
                         Background="{StaticResource ControlBackground}"
                         Foreground="{StaticResource ForegroundColor}"
                         BorderBrush="{StaticResource BorderColor}"
                         BorderThickness="1"
                         SelectionMode="Multiple"
                         SelectionChanged="LstColumnVisibility_SelectionChanged">
                </ListBox>

                <TextBlock Text="Select columns to show/hide" 
                           FontSize="10" 
                           Foreground="{StaticResource DisabledColor}"
                           Margin="0,5,0,0"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <!-- RIGHT SIDE: DataGrid -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="40"/>
            </Grid.RowDefinitions>

            <!-- Top toolbar -->
            <Border Grid.Row="0" 
                    Background="{StaticResource ToolbarBackground}" 
                    BorderBrush="{StaticResource BorderColor}" 
                    BorderThickness="0,0,0,1"
                    Padding="10,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Search:" 
                               Foreground="{StaticResource TextColorSecondary}" 
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <TextBox x:Name="txtSearch"
                             Width="250"
                             Height="25"
                             Background="{StaticResource ControlBackground}"
                             Foreground="{StaticResource ForegroundColor}"
                             BorderBrush="{StaticResource BorderColor}"
                             BorderThickness="1"
                             Padding="5"
                             VerticalContentAlignment="Center"
                             TextChanged="TxtSearch_TextChanged"/>

                    <Button x:Name="btnRefresh"
                            Content="Refresh"
                            Width="80"
                            Height="28"
                            Margin="20,0,0,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnRefresh_Click"/>

                    <TextBlock x:Name="txtFilteredCount"
                               Text="0 records"
                               Foreground="{StaticResource TextColorSecondary}"
                               VerticalAlignment="Center"
                               Margin="20,0,0,0"/>
                </StackPanel>
            </Border>

            <!-- DataGrid with VIRTUALIZATION ENABLED -->
            <Border Grid.Row="1" 
                    BorderBrush="{StaticResource BorderColor}" 
                    BorderThickness="0">
                <DataGrid x:Name="dgActivities"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="True"
                          CanUserSortColumns="True"
                          SelectionMode="Extended"
                          SelectionUnit="FullRow"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="True"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          Background="{StaticResource BackgroundColor}"
                          Foreground="{StaticResource ForegroundColor}"
                          BorderBrush="{StaticResource BorderColor}"
                          BorderThickness="0"
                          GridLinesVisibility="All"
                          HorizontalGridLinesBrush="{StaticResource BorderColor}"
                          VerticalGridLinesBrush="{StaticResource BorderColor}"
                          RowHeight="28"
                          HeadersVisibility="Column"
                          CellEditEnding="DgActivities_CellEditEnding"
                          SelectionChanged="DgActivities_SelectionChanged">

                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="{StaticResource GridHeaderBackground}"/>
                            <Setter Property="Foreground" Value="{StaticResource GridHeaderForeground}"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="Padding" Value="8,5"/>
                            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
                            <Setter Property="BorderThickness" Value="0,0,1,1"/>
                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
                            <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsMyRecord}" Value="True">
                                    <Setter Property="Background" Value="{StaticResource MyRecordsBackground}"/>
                                </DataTrigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{StaticResource GridSelectedRowBackground}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
                            <Setter Property="BorderThickness" Value="0,0,1,0"/>
                            <Setter Property="Padding" Value="5,0"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{StaticResource GridSelectedRowBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.CellStyle>

                    <DataGrid.ContextMenu>
                        <ContextMenu Background="{StaticResource ControlBackground}" 
                                     Foreground="{StaticResource ForegroundColor}"
                                     BorderBrush="{StaticResource BorderColor}">
                            <MenuItem Header="Assign to Me" 
                                      Click="MenuAssignToMe_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <MenuItem Header="Assign to User..." 
                                      Click="MenuAssignToUser_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <Separator Background="{StaticResource BorderColor}"/>
                            <MenuItem Header="Mark Complete (100%)" 
                                      Click="MenuMarkComplete_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <MenuItem Header="Mark Not Started (0%)" 
                                      Click="MenuMarkNotStarted_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                            <MenuItem Header="Update Percent..." 
                                      Click="MenuUpdatePercent_Click"
                                      Background="{StaticResource ControlBackground}"
                                      Foreground="{StaticResource ForegroundColor}"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>

                    <!-- ALL YOUR EXISTING COLUMNS (keeping them exactly as they are) -->
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Activity ID" 
                                            Binding="{Binding UDFNineteen}" 
                                            Width="120"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource ControlBackground}"/>
                                    <Setter Property="Foreground" Value="{StaticResource DisabledColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Description" 
                                            Binding="{Binding Tag_Descriptions}" 
                                            Width="250"/>

                        <DataGridTextColumn Header="Component Type" 
                                            Binding="{Binding Catg_ComponentType}" 
                                            Width="120"/>

                        <DataGridTextColumn Header="Phase Category" 
                                            Binding="{Binding Catg_PhaseCategory}" 
                                            Width="120"/>

                        <DataGridTextColumn Header="ROC Step" 
                                            Binding="{Binding Catg_ROC_Step}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Project ID" 
                                            Binding="{Binding Tag_ProjectID}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Work Package" 
                                            Binding="{Binding Tag_WorkPackage}" 
                                            Width="120"/>

                        <DataGridTextColumn Header="Phase Code" 
                                            Binding="{Binding Tag_Phase_Code}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Drawing No" 
                                            Binding="{Binding Dwg_PrimeDrawingNO}" 
                                            Width="120"/>

                        <DataGridTextColumn Header="Sch Start" 
                                            Binding="{Binding Sch_Start}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Sch Finish" 
                                            Binding="{Binding Sch_Finish}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Sch Status" 
                                            Binding="{Binding Sch_Status}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Activity No" 
                                            Binding="{Binding Tag_Sch_ActNo}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Quantity" 
                                            Binding="{Binding Val_Quantity, StringFormat=N2}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Earned Qty" 
                                            Binding="{Binding Val_EarnedQty, StringFormat=N2, UpdateSourceTrigger=LostFocus}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="% Complete" 
                                            Binding="{Binding Val_Perc_Complete, StringFormat=N2, UpdateSourceTrigger=LostFocus}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Budget Hrs" 
                                            Binding="{Binding Val_BudgetedHours_Ind, StringFormat=N2}" 
                                            Width="100"/>

                        <DataGridTextColumn Header="Earned Hrs" 
                                            Binding="{Binding Val_EarnedHours_Ind, StringFormat=N3}" 
                                            Width="100"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource GridAlternatingRowBackground}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Status" 
                                            Binding="{Binding Status}" 
                                            Width="100"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Background" Value="{StaticResource GridAlternatingRowBackground}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="UDF One" 
                                            Binding="{Binding UDFOne}" 
                                            Width="120"/>

                        <DataGridTextColumn Header="UDF Two" 
                                            Binding="{Binding UDFTwo}" 
                                            Width="120"/>

                        <DataGridTextColumn Header="Assigned To" 
                                            Binding="{Binding AssignedToUsername}" 
                                            Width="120"/>

                        <!-- ALL OTHER COLLAPSED COLUMNS (keeping exactly as you have them) -->
                        <DataGridTextColumn Header="Hex NO" 
                                            Binding="{Binding HexNO}" 
                                            Width="80"
                                            Visibility="Collapsed"/>
                        <!-- ... (all your other collapsed columns remain exactly the same) ... -->

                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- PAGING CONTROLS (Bottom toolbar) -->
            <Border Grid.Row="2" 
                    Background="{StaticResource ToolbarBackground}" 
                    BorderBrush="{StaticResource BorderColor}" 
                    BorderThickness="0,1,0,0"
                    Padding="10,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Button x:Name="btnFirstPage"
                            Content="⏮ First"
                            Width="80"
                            Height="28"
                            Margin="5,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnFirstPage_Click"/>

                    <Button x:Name="btnPreviousPage"
                            Content="◀ Previous"
                            Width="90"
                            Height="28"
                            Margin="5,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnPreviousPage_Click"/>

                    <TextBlock x:Name="txtPageInfo"
                               Text="Page 1 of 1"
                               Foreground="{StaticResource ForegroundColor}"
                               VerticalAlignment="Center"
                               Margin="20,0"
                               FontWeight="Bold"/>

                    <Button x:Name="btnNextPage"
                            Content="Next ▶"
                            Width="90"
                            Height="28"
                            Margin="5,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnNextPage_Click"/>

                    <Button x:Name="btnLastPage"
                            Content="Last ⏭"
                            Width="80"
                            Height="28"
                            Margin="5,0"
                            Background="{StaticResource ControlBackground}"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnLastPage_Click"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>