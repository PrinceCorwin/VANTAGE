<UserControl x:Class="VANTAGE.Views.SidePanelView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             Background="{StaticResource ControlBackground}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with tabs and close button -->
        <Border Grid.Row="0" 
                Background="{StaticResource DarkestBackgroundColor}" 
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                Padding="10,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Tab Buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="btnHelpTab"
                            Content="Help"
                            Padding="15,6"
                            Margin="0,0,5,0"
                            Background="{StaticResource AccentColor}"
                            Foreground="White"
                            BorderThickness="0"
                            FontWeight="SemiBold"
                            Click="BtnHelpTab_Click"
                            Cursor="Hand"/>
                    <Button x:Name="btnAiTab"
                            Content="AI Assistant"
                            Padding="15,6"
                            Background="Transparent"
                            Foreground="{StaticResource ForegroundColor}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Click="BtnAiTab_Click"
                            Cursor="Hand"/>
                </StackPanel>

                <!-- Close Button -->
                <Button Grid.Column="1"
                        Content="✕"
                        Width="30"
                        Height="30"
                        Background="Transparent"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderThickness="0"
                        FontSize="14"
                        Click="BtnClose_Click"
                        ToolTip="Close sidebar (Esc)"
                        Cursor="Hand"/>
            </Grid>
        </Border>

        <!-- Action Buttons Row -->
        <Border Grid.Row="1"
                Background="{StaticResource BackgroundColor}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                Padding="10,6">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock x:Name="btnBackToTop"
                           Text="Back to Top"
                           FontSize="12"
                           Foreground="{StaticResource AccentColor}"
                           Cursor="Hand"
                           Margin="0,0,16,0"
                           MouseLeftButtonUp="BtnBackToTop_Click"
                           ToolTip="Scroll to top of help content"/>
                <TextBlock Text="│"
                           FontSize="12"
                           Foreground="{StaticResource BorderColor}"
                           Margin="0,0,16,0"/>
                <TextBlock x:Name="btnPrintPdf"
                           Text="Print PDF"
                           FontSize="12"
                           Foreground="{StaticResource AccentColor}"
                           Cursor="Hand"
                           Margin="0,0,16,0"
                           MouseLeftButtonUp="BtnPrintPdf_Click"
                           ToolTip="Print help content to PDF"/>
                <TextBlock Text="│"
                           FontSize="12"
                           Foreground="{StaticResource BorderColor}"
                           Margin="0,0,16,0"/>
                <TextBlock x:Name="btnViewInBrowser"
                           Text="View in Browser"
                           FontSize="12"
                           Foreground="{StaticResource AccentColor}"
                           Cursor="Hand"
                           MouseLeftButtonUp="BtnViewInBrowser_Click"
                           ToolTip="Open help in default web browser"/>
            </StackPanel>
        </Border>

        <!-- Search Field (Help tab only) -->
        <Border x:Name="searchFieldRow"
                Grid.Row="2"
                Background="{StaticResource ControlBackground}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                Padding="8,6"
                Visibility="Visible">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search TextBox with Clear Button -->
                <Grid Grid.Column="0">
                    <TextBox x:Name="txtSearch"
                             Padding="6,4,24,4"
                             FontSize="12"
                             Background="{StaticResource DarkestBackgroundColor}"
                             Foreground="{StaticResource ForegroundColor}"
                             BorderBrush="{StaticResource BorderColor}"
                             BorderThickness="1"
                             VerticalContentAlignment="Center"
                             TextChanged="TxtSearch_TextChanged"
                             KeyDown="TxtSearch_KeyDown"/>

                    <!-- Placeholder text -->
                    <TextBlock x:Name="txtSearchPlaceholder"
                               Text="Search..."
                               FontSize="12"
                               FontStyle="Italic"
                               Foreground="#666666"
                               VerticalAlignment="Center"
                               Margin="8,0,0,0"
                               IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=txtSearch}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <!-- Clear button -->
                    <Button x:Name="btnClearSearch"
                            Content="✕"
                            Width="20"
                            Height="20"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Margin="0,0,4,0"
                            Background="Transparent"
                            Foreground="{StaticResource TextColorSecondary}"
                            BorderThickness="0"
                            FontSize="10"
                            Cursor="Hand"
                            Click="BtnClearSearch_Click"
                            ToolTip="Clear search">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=txtSearch}" Value="">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>

                <!-- Previous Match Button -->
                <Button x:Name="btnSearchPrev"
                        Grid.Column="1"
                        Content="▲"
                        Width="32"
                        Height="28"
                        Margin="4,0,0,0"
                        Padding="0"
                        Click="BtnSearchPrev_Click"
                        Background="Transparent"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        FontSize="14"
                        FontWeight="Bold"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        ToolTip="Find previous match (Shift+Enter)"
                        ToolTipService.ShowOnDisabled="True"
                        IsEnabled="False"
                        Cursor="Hand"/>

                <!-- Next Match Button -->
                <Button x:Name="btnSearchNext"
                        Grid.Column="2"
                        Content="▼"
                        Width="32"
                        Height="28"
                        Margin="4,0,0,0"
                        Padding="0"
                        Click="BtnSearchNext_Click"
                        Background="Transparent"
                        Foreground="{StaticResource ForegroundColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        FontSize="14"
                        FontWeight="Bold"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        ToolTip="Find next match (Enter)"
                        ToolTipService.ShowOnDisabled="True"
                        IsEnabled="False"
                        Cursor="Hand"/>

                <!-- Match Counter -->
                <TextBlock x:Name="txtMatchCount"
                           Grid.Column="3"
                           Text=""
                           FontSize="11"
                           Foreground="{StaticResource ForegroundColor}"
                           VerticalAlignment="Center"
                           Margin="8,0,0,0"
                           MinWidth="50"/>
            </Grid>
        </Border>

        <!-- Help Content (WebView2) -->
        <Grid x:Name="gridHelpContent" Grid.Row="3" Visibility="Visible">
            <wv2:WebView2 x:Name="webViewHelp"
                          DefaultBackgroundColor="Transparent"/>

            <!-- Loading/Error overlay -->
            <Border x:Name="helpOverlay"
                    Background="{StaticResource ControlBackground}"
                    Visibility="Collapsed">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock x:Name="txtHelpStatus"
                               Text="Loading help..."
                               FontSize="14"
                               Foreground="{StaticResource ForegroundColor}"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- AI Content (placeholder) -->
        <Grid x:Name="gridAiContent" Grid.Row="3" Visibility="Collapsed">
            <Border Background="{StaticResource ControlBackground}"
                    Padding="20">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="AI Assistant"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource ForegroundColor}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10"/>
                    <TextBlock Text="Coming soon..."
                               FontSize="13"
                               Foreground="{StaticResource ForegroundColor}"
                               Opacity="0.6"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>