<UserControl x:Class="VANTAGE.Views.WorkPackageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:pdfviewer="clr-namespace:Syncfusion.Windows.PdfViewer;assembly=Syncfusion.PdfViewer.WPF"
             xmlns:skinManager="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
             skinManager:SfSkinManager.Theme="{skinManager:SkinManagerExtension ThemeName=FluentDark}"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400"
             Background="{StaticResource BackgroundColor}">

    <UserControl.Resources>
        <!-- Default TextBlock style for visibility on dark background -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
        </Style>

        <!-- Default TextBox style matching Admin dialogs -->
        <Style TargetType="TextBox">
            <Setter Property="Height" Value="28"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="Padding" Value="5,3"/>
        </Style>


        <!-- Rounded Button Style -->
        <Style x:Key="RoundedButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource ControlBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundColor}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter Content="{TemplateBinding Content}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ControlBorder}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Button Style (for Generate button) -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource RoundedButtonStyle}">
            <Setter Property="Background" Value="{StaticResource AccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="20,10"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Bar -->
        <Border Grid.Row="0" Background="{StaticResource ControlBackground}" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="Work Packages"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="{StaticResource ForegroundColor}"
                           VerticalAlignment="Center"/>

                <!-- Import/Export Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Import"
                            Style="{StaticResource RoundedButtonStyle}"
                            Click="BtnImport_Click"
                            ToolTip="Import templates from JSON file"
                            Margin="0,0,10,0"/>
                    <Button Content="Export"
                            Style="{StaticResource RoundedButtonStyle}"
                            Click="BtnExport_Click"
                            ToolTip="Export templates to JSON file"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content - Split View -->
        <Grid x:Name="MainSplitGrid" Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="LeftPanelColumn" Width="6*" MinWidth="400"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition x:Name="RightPanelColumn" Width="4*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Tabs -->
            <TabControl x:Name="MainTabControl"
                        Grid.Column="0"
                        Background="{StaticResource BackgroundColor}"
                        BorderThickness="0"
                        Padding="10"
                        SelectionChanged="MainTabControl_SelectionChanged">

                <!-- Generate Tab -->
                <TabItem Header="Generate">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                        <StackPanel x:Name="GenerateTabContent">
                            <!-- Project Selection -->
                            <TextBlock Text="Project" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="cboProject"
                                      SelectedValuePath="ProjectID"
                                      SelectionChanged="CboProject_SelectionChanged"
                                      Margin="0,0,0,15"
                                      ToolTip="Select the project for work package generation">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <Run Text="{Binding ProjectID}"/>
                                            <Run Text=" "/>
                                            <Run Text="{Binding Description}"/>
                                        </TextBlock>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <!-- Work Packages List -->
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Work Packages" FontWeight="Bold" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Content="Select All" Click="BtnSelectAll_Click" Padding="8,4" Margin="0,0,5,0"/>
                                    <Button Content="Clear" Click="BtnClearSelection_Click" Padding="8,4"/>
                                </StackPanel>
                            </Grid>
                            <ListBox x:Name="lstWorkPackages"
                                     Height="150"
                                     SelectionMode="Multiple"
                                     ToolTip="Select one or more work packages to generate">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <CheckBox Content="{Binding}"
                                                  IsChecked="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <!-- WP Template -->
                            <TextBlock Text="WP Template" FontWeight="Bold" Margin="0,15,0,5"/>
                            <ComboBox x:Name="cboWPTemplate"
                                      DisplayMemberPath="WPTemplateName"
                                      SelectedValuePath="WPTemplateID"
                                      SelectionChanged="CboWPTemplate_SelectionChanged"
                                      ToolTip="Select the work package template to use"
                                      Margin="0,0,0,15"/>

                            <!-- PKG Manager -->
                            <TextBlock Text="PKG Manager" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="cboPKGManager"
                                      SelectionChanged="CboPKGManager_SelectionChanged"
                                      ToolTip="Select the package manager"
                                      Margin="0,0,0,15"/>

                            <!-- Scheduler -->
                            <TextBlock Text="Scheduler" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="cboScheduler"
                                      SelectionChanged="CboScheduler_SelectionChanged"
                                      ToolTip="Select the scheduler"
                                      Margin="0,0,0,15"/>

                            <!-- WP Name Pattern -->
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="WP Name Pattern" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBox x:Name="txtWPNamePattern"
                                         Grid.Row="1"
                                         ToolTip="Enter pattern with {tokens} like {WorkPackage}, {Area}, {UDF2}"/>
                                <Button x:Name="btnInsertField"
                                        Grid.Row="1" Grid.Column="1"
                                        Content="+ Field"
                                        Click="BtnInsertField_Click"
                                        Padding="8,4"
                                        Margin="5,0,0,0"
                                        ToolTip="Insert a field token at cursor position"/>
                            </Grid>

                            <!-- Logo Path -->
                            <TextBlock Text="Logo" FontWeight="Bold" Margin="0,0,0,5"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="txtLogoPath" IsReadOnly="True" ToolTip="Leave as (default) to use the built-in Summit logo, or browse to select a custom logo"/>
                                <Button Grid.Column="1" Content="Browse" Click="BtnBrowseLogo_Click" Padding="8,4" Margin="5,0,0,0"/>
                            </Grid>

                            <!-- Output Folder with Generate Button -->
                            <TextBlock Text="Output Folder" FontWeight="Bold" Margin="0,0,0,5"/>
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="txtOutputFolder" IsReadOnly="True" ToolTip="Folder where PDFs will be saved"/>
                                <Button Grid.Column="1" Content="Browse" Click="BtnBrowseOutput_Click" Padding="8,4" Margin="5,0,0,0"/>
                                <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
                                    <CheckBox x:Name="chkIndividualPdfs"
                                              Content="Also output individual form PDFs"
                                              Foreground="{StaticResource ForegroundColor}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,15,0"
                                              ToolTip="Save each form as a separate PDF in addition to the merged document"/>
                                    <Button x:Name="btnGenerate"
                                            Content="GENERATE"
                                            Style="{StaticResource PrimaryButtonStyle}"
                                            Click="BtnGenerate_Click"
                                            MinWidth="120"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- WP Templates Tab -->
                <TabItem Header="WP Templates">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                        <StackPanel x:Name="WPTemplatesTabContent">
                            <!-- Template Selection -->
                            <TextBlock Text="WP Template" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="cboWPTemplateEdit"
                                      SelectionChanged="CboWPTemplateEdit_SelectionChanged"
                                      ToolTip="Select a template to edit or '+ Add New' to create"
                                      Margin="0,0,0,15"/>

                            <!-- Name -->
                            <TextBlock Text="Name" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="txtWPTemplateName" Margin="0,0,0,10"/>

                            <!-- Clone/Delete Buttons -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <Button Content="Clone" Click="BtnCloneWPTemplate_Click" Padding="8,4" Margin="0,0,10,0"/>
                                <Button Content="Delete" Click="BtnDeleteWPTemplate_Click" Padding="8,4"/>
                            </StackPanel>

                            <Separator Margin="0,0,0,15"/>

                            <!-- Expiration Days -->
                            <TextBlock Text="Expiration Days" FontWeight="Bold" Margin="0,0,0,5"/>
                            <syncfusion:IntegerTextBox x:Name="txtExpirationDays"
                                                        Value="14"
                                                        MinValue="1"
                                                        MaxValue="365"
                                                        Margin="0,0,0,15"
                                                        ToolTip="Number of days until work package expires"/>

                            <!-- Forms in WP -->
                            <Grid Margin="0,0,0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Forms in WP" FontWeight="Bold" VerticalAlignment="Center"/>
                                <syncfusion:DropDownButtonAdv x:Name="btnAddForm"
                                                               Grid.Column="1"
                                                               Label="+ Add Form"
                                                               Padding="0"
                                                               Background="Transparent"
                                                               Foreground="{StaticResource ForegroundColor}"
                                                               BorderThickness="0"
                                                               IconTemplate="{x:Null}"
                                                               SmallIcon="{x:Null}"
                                                               LargeIcon="{x:Null}"
                                                               FontSize="12"
                                                               SizeMode="Normal"
                                                               ToolTip="Add a form to this work package template">
                                    <syncfusion:DropDownMenuGroup x:Name="menuAddFormGroup"
                                                                   Background="{StaticResource ControlBackground}"
                                                                   Foreground="{StaticResource ForegroundColor}"
                                                                   BorderBrush="{StaticResource BorderColor}"/>
                                </syncfusion:DropDownButtonAdv>
                            </Grid>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ListBox x:Name="lstWPForms"
                                         Height="200"
                                         DisplayMemberPath="TemplateName"/>
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0">
                                    <Button Content="▲" Click="BtnMoveFormUp_Click" Padding="8,4" Margin="0,0,0,5" ToolTip="Move up"/>
                                    <Button Content="▼" Click="BtnMoveFormDown_Click" Padding="8,4" Margin="0,0,0,5" ToolTip="Move down"/>
                                    <Button Content="✕" Click="BtnRemoveForm_Click" Padding="8,4" ToolTip="Remove"/>
                                </StackPanel>
                            </Grid>

                            <!-- Save Button -->
                            <Button x:Name="btnSaveWPTemplate"
                                    Content="Save"
                                    Style="{StaticResource RoundedButtonStyle}"
                                    Click="BtnSaveWPTemplate_Click"
                                    HorizontalAlignment="Right"
                                    MinWidth="100"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Form Templates Tab -->
                <TabItem Header="Form Templates">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                        <StackPanel x:Name="FormTemplatesTabContent">
                            <!-- Template Selection with Type -->
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="3*"/>
                                    <ColumnDefinition Width="7*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Form Template" FontWeight="Bold" Margin="0,0,0,5"/>
                                    <ComboBox x:Name="cboFormTemplateEdit"
                                              SelectionChanged="CboFormTemplateEdit_SelectionChanged"
                                              ToolTip="Select a template to edit or '+ Add New' to create"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="20,0,0,0">
                                    <TextBlock Text="Type" FontWeight="Bold" Margin="0,0,0,5"/>
                                    <TextBlock x:Name="lblFormTemplateType"
                                               FontSize="14"
                                               VerticalAlignment="Center"
                                               Foreground="{StaticResource TextColorSecondary}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Name -->
                            <TextBlock Text="Name" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="txtFormTemplateName" Margin="0,0,0,10"/>

                            <!-- Clone/Delete Buttons -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <Button Content="Clone" Click="BtnCloneFormTemplate_Click" Padding="8,4" Margin="0,0,10,0"/>
                                <Button Content="Delete" Click="BtnDeleteFormTemplate_Click" Padding="8,4"/>
                            </StackPanel>

                            <Separator Margin="0,0,0,15"/>

                            <!-- Type-specific Editor (placeholder - will be replaced by ContentControl) -->
                            <ContentControl x:Name="FormEditorContent"/>

                            <!-- Save Button -->
                            <Button x:Name="btnSaveFormTemplate"
                                    Content="Save"
                                    Style="{StaticResource RoundedButtonStyle}"
                                    Click="BtnSaveFormTemplate_Click"
                                    HorizontalAlignment="Right"
                                    MinWidth="100"
                                    Margin="0,15,0,0"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>

            <!-- GridSplitter -->
            <GridSplitter Grid.Column="1"
                          Width="5"
                          HorizontalAlignment="Stretch"
                          Background="{StaticResource BorderColor}"
                          Cursor="SizeWE"
                          DragCompleted="GridSplitter_DragCompleted"/>

            <!-- Right Panel - Preview -->
            <Grid Grid.Column="2" Background="{StaticResource ControlBackground}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Preview Header -->
                <Border Grid.Row="0" Background="{StaticResource BackgroundColor}" Padding="10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="PREVIEW" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock x:Name="lblPreviewContext"
                                   Grid.Column="0"
                                   Text=""
                                   FontStyle="Italic"
                                   Foreground="{StaticResource TextColorSecondary}"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>
                    </Grid>
                </Border>

                <!-- PDF Viewer -->
                <Grid Grid.Row="1" Margin="5">
                    <!-- Placeholder shown when no PDF loaded -->
                    <Border x:Name="pdfPlaceholderBorder"
                            Background="{StaticResource ControlBackground}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1">
                        <TextBlock x:Name="pdfPlaceholder"
                                   Text="PDF Preview Area&#x0a;&#x0a;Click 'Refresh Preview' to generate"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   TextAlignment="Center"
                                   Foreground="{StaticResource TextColorSecondary}"
                                   FontStyle="Italic"/>
                    </Border>
                    <!-- Actual PDF Viewer -->
                    <pdfviewer:PdfViewerControl x:Name="pdfViewer"
                                                 Visibility="Collapsed"
                                                 EnableNotificationBar="False"/>
                </Grid>

                <!-- Refresh Button -->
                <Border Grid.Row="2" Background="{StaticResource BackgroundColor}" Padding="10">
                    <Button x:Name="btnRefreshPreview"
                            Content="Refresh Preview"
                            Style="{StaticResource RoundedButtonStyle}"
                            Click="BtnRefreshPreview_Click"
                            HorizontalAlignment="Center"/>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{StaticResource ControlBackground}" Padding="10,5">
            <TextBlock x:Name="lblStatus"
                       Text="Ready"
                       Foreground="{StaticResource TextColorSecondary}"/>
        </Border>
    </Grid>
</UserControl>
